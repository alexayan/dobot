<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>API Reference &mdash; peewee 2.6.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.6.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="peewee 2.6.1 documentation" href="../index.html" />
    <link rel="next" title="Playhouse, a collection of addons" href="playhouse.html" />
    <link rel="prev" title="Transactions" href="transactions.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="playhouse.html" title="Playhouse, a collection of addons"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="transactions.html" title="Transactions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">peewee 2.6.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="api-reference">
<span id="api"></span><h1>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h1>
<div class="section" id="models">
<span id="model-api"></span><h2>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="Model">
<em class="property">class </em><code class="descname">Model</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#Model" title="Permalink to this definition">¶</a></dt>
<dd><p>Models provide a 1-to-1 mapping to database tables. Subclasses of
<code class="docutils literal"><span class="pre">Model</span></code> declare any number of <code class="xref py py-class docutils literal"><span class="pre">Field</span></code> instances as class
attributes. These fields correspond to columns on the table.</p>
<p>Table-level operations, such as <a class="reference internal" href="#Model.select" title="Model.select"><code class="xref py py-meth docutils literal"><span class="pre">select()</span></code></a>, <a class="reference internal" href="#Model.update" title="Model.update"><code class="xref py py-meth docutils literal"><span class="pre">update()</span></code></a>,
<a class="reference internal" href="#Model.insert" title="Model.insert"><code class="xref py py-meth docutils literal"><span class="pre">insert()</span></code></a>, and <a class="reference internal" href="#Model.delete" title="Model.delete"><code class="xref py py-meth docutils literal"><span class="pre">delete()</span></code></a>, are implemented
as classmethods. Row-level operations such as <a class="reference internal" href="#Model.save" title="Model.save"><code class="xref py py-meth docutils literal"><span class="pre">save()</span></code></a> and
<a class="reference internal" href="#Model.delete_instance" title="Model.delete_instance"><code class="xref py py-meth docutils literal"><span class="pre">delete_instance()</span></code></a> are implemented as instancemethods.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>kwargs</strong> &#8211; Initialize the model, assigning the given key/values to the
appropriate fields.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">join_date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
    <span class="n">is_admin</span> <span class="o">=</span> <span class="n">BooleanField</span><span class="p">()</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;charlie&#39;</span><span class="p">,</span> <span class="n">is_admin</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<dl class="classmethod">
<dt id="Model.select">
<em class="property">classmethod </em><code class="descname">select</code><span class="sig-paren">(</span><em>*selection</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.select" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>selection</strong> &#8211; A list of model classes, field instances, functions
or expressions. If no argument is provided, all columns for the given model
will be selected.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">a <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> for the given <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a>.</td>
</tr>
</tbody>
</table>
<p>Examples of selecting all columns (default):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
</pre></div>
</div>
<p>Example of selecting all columns on <em>Tweet</em> and the parent model,
<em>User</em>. When the <code class="docutils literal"><span class="pre">user</span></code> foreign key is accessed on a <em>Tweet</em>
instance no additional query will be needed (see <a class="reference internal" href="querying.html#nplusone"><span>N+1</span></a>
for more details):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="n">Tweet</span>
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">User</span><span class="p">)</span>
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
  <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span><span class="o">.</span><span class="n">desc</span><span class="p">()))</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.update">
<em class="property">classmethod </em><code class="descname">update</code><span class="sig-paren">(</span><em>**update</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.update" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>update</strong> &#8211; mapping of field-name to expression</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">an <a class="reference internal" href="#UpdateQuery" title="UpdateQuery"><code class="xref py py-class docutils literal"><span class="pre">UpdateQuery</span></code></a> for the given <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a></td>
</tr>
</tbody>
</table>
<p>Example showing users being marked inactive if their registration
expired:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">registration_expired</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c"># Execute the query, updating the database.</span>
</pre></div>
</div>
<p>Example showing an atomic update:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">PageView</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">PageView</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="n">url</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c"># execute the query, updating the database.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When an update query is executed, the number of rows modified will be returned.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.insert">
<em class="property">classmethod </em><code class="descname">insert</code><span class="sig-paren">(</span><em>**insert</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.insert" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert a new row into the database. If any fields on the model have
default values, these values will be used if the fields are not explicitly
set in the <code class="docutils literal"><span class="pre">insert</span></code> dictionary.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>insert</strong> &#8211; mapping of field or field-name to expression.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">an <a class="reference internal" href="#InsertQuery" title="InsertQuery"><code class="xref py py-class docutils literal"><span class="pre">InsertQuery</span></code></a> for the given <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a>.</td>
</tr>
</tbody>
</table>
<p>Example showing creation of a new user:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;admin&#39;</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">registration_expired</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c"># perform the insert.</span>
</pre></div>
</div>
<p>You can also use <code class="xref py py-class docutils literal"><span class="pre">Field</span></code> objects as the keys:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">User</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">:</span> <span class="s">&#39;admin&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
<p>If you have a model with a default value on one of the fields, and
that field is not specified in the <code class="docutils literal"><span class="pre">insert</span></code> parameter, the default
will be used:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">active</span> <span class="o">=</span> <span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># This INSERT query will automatically specify `active=True`:</span>
<span class="n">User</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;charlie&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When an insert query is executed on a table with an auto-incrementing primary key, the primary key of the new row will be returned.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Model.insert_many">
<code class="descname">insert_many</code><span class="sig-paren">(</span><em>rows</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.insert_many" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert multiple rows at once. The <code class="docutils literal"><span class="pre">rows</span></code> parameter must be an iterable
that yields dictionaries. As with <a class="reference internal" href="#Model.insert" title="Model.insert"><code class="xref py py-meth docutils literal"><span class="pre">insert()</span></code></a>, fields that
are not specified in the dictionary will use their default value, if
one exists.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Due to the nature of bulk inserts, each row must contain the same
fields. The following will not work:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">Person</span><span class="o">.</span><span class="n">insert_many</span><span class="p">([</span>
    <span class="p">{</span><span class="s">&#39;first_name&#39;</span><span class="p">:</span> <span class="s">&#39;Peewee&#39;</span><span class="p">,</span> <span class="s">&#39;last_name&#39;</span><span class="p">:</span> <span class="s">&#39;Herman&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s">&#39;first_name&#39;</span><span class="p">:</span> <span class="s">&#39;Huey&#39;</span><span class="p">},</span>  <span class="c"># Missing &quot;last_name&quot;!</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>rows</strong> &#8211; An iterable containing dictionaries of field-name-to-value.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">an <a class="reference internal" href="#InsertQuery" title="InsertQuery"><code class="xref py py-class docutils literal"><span class="pre">InsertQuery</span></code></a> for the given <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a>.</td>
</tr>
</tbody>
</table>
<p>Example of inserting multiple Users:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">usernames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;charlie&#39;</span><span class="p">,</span> <span class="s">&#39;huey&#39;</span><span class="p">,</span> <span class="s">&#39;peewee&#39;</span><span class="p">,</span> <span class="s">&#39;mickey&#39;</span><span class="p">]</span>
<span class="n">row_dicts</span> <span class="o">=</span> <span class="p">({</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">}</span> <span class="k">for</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">usernames</span><span class="p">)</span>

<span class="c"># Insert 4 new rows.</span>
<span class="n">User</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">row_dicts</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
<p>Because the <code class="docutils literal"><span class="pre">rows</span></code> parameter can be an arbitrary iterable, you can
also use a generator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_usernames</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">username</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;charlie&#39;</span><span class="p">,</span> <span class="s">&#39;huey&#39;</span><span class="p">,</span> <span class="s">&#39;peewee&#39;</span><span class="p">]:</span>
        <span class="k">yield</span> <span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">}</span>
<span class="n">User</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">get_usernames</span><span class="p">())</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.insert_from">
<em class="property">classmethod </em><code class="descname">insert_from</code><span class="sig-paren">(</span><em>fields</em>, <em>query</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.insert_from" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert rows into the table using a query as the data source. This API should
be used for <em>INSERT INTO...SELECT FROM</em> queries.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fields</strong> &#8211; The field objects to map the selected data into.</li>
<li><strong>query</strong> &#8211; The source of the new rows.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">an <a class="reference internal" href="#InsertQuery" title="InsertQuery"><code class="xref py py-class docutils literal"><span class="pre">InsertQuery</span></code></a> for the given <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a>.</p>
</td>
</tr>
</tbody>
</table>
<p>Example of inserting data across tables for denormalization purposes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
          <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">COUNT</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
          <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">JOIN</span><span class="o">.</span><span class="n">LEFT_OUTER</span><span class="p">)</span>
          <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
<span class="n">UserTweetDenorm</span><span class="o">.</span><span class="n">insert_from</span><span class="p">(</span>
    <span class="p">[</span><span class="n">UserTweetDenorm</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">UserTweetDenorm</span><span class="o">.</span><span class="n">num_tweets</span><span class="p">],</span>
    <span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.delete">
<em class="property">classmethod </em><code class="descname">delete</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.delete" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">a <a class="reference internal" href="#DeleteQuery" title="DeleteQuery"><code class="xref py py-class docutils literal"><span class="pre">DeleteQuery</span></code></a> for the given <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a>.</td>
</tr>
</tbody>
</table>
<p>Example showing the deletion of all inactive users:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">False</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c"># remove the rows</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This method performs a delete on the <em>entire table</em>. To delete a
single instance, see <a class="reference internal" href="#Model.delete_instance" title="Model.delete_instance"><code class="xref py py-meth docutils literal"><span class="pre">Model.delete_instance()</span></code></a>.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.raw">
<em class="property">classmethod </em><code class="descname">raw</code><span class="sig-paren">(</span><em>sql</em>, <em>*params</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.raw" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sql</strong> &#8211; a string SQL expression</li>
<li><strong>params</strong> &#8211; any number of parameters to interpolate</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">a <a class="reference internal" href="#RawQuery" title="RawQuery"><code class="xref py py-class docutils literal"><span class="pre">RawQuery</span></code></a> for the given <code class="docutils literal"><span class="pre">Model</span></code></p>
</td>
</tr>
</tbody>
</table>
<p>Example selecting rows from the User table:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="s">&#39;select id, username from users&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">q</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Generally the use of <code class="docutils literal"><span class="pre">raw</span></code> is reserved for those cases where you
can significantly optimize a select query. It is useful for select
queries since it will return instances of the model.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.create">
<em class="property">classmethod </em><code class="descname">create</code><span class="sig-paren">(</span><em>**attributes</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.create" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>attributes</strong> &#8211; key/value pairs of model attributes</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">a model instance with the provided attributes</td>
</tr>
</tbody>
</table>
<p>Example showing the creation of a user (a row will be added to the
database):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;admin&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The create() method is a shorthand for instantiate-then-save.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.get">
<em class="property">classmethod </em><code class="descname">get</code><span class="sig-paren">(</span><em>*args</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.get" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> &#8211; a list of query expressions, e.g. <code class="docutils literal"><span class="pre">User.username</span> <span class="pre">==</span> <span class="pre">'foo'</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> instance or raises <code class="docutils literal"><span class="pre">DoesNotExist</span></code> exception</td>
</tr>
</tbody>
</table>
<p>Get a single row from the database that matches the given query.
Raises a <code class="docutils literal"><span class="pre">&lt;model-class&gt;.DoesNotExist</span></code> if no rows are returned:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">username</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This method is also exposed via the <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a>, though it
takes no parameters:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">active</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">active</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">username</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="k">except</span> <span class="n">User</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference internal" href="#Model.get" title="Model.get"><code class="xref py py-meth docutils literal"><span class="pre">get()</span></code></a> method is shorthand for selecting with a limit of 1. It
has the added behavior of raising an exception when no matching row is
found. If more than one row is found, the first row returned by the
database cursor will be used.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.get_or_create">
<em class="property">classmethod </em><code class="descname">get_or_create</code><span class="sig-paren">(</span><span class="optional">[</span><em>defaults=None</em><span class="optional">[</span>, <em>**kwargs</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.get_or_create" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>defaults</strong> (<em>dict</em>) &#8211; A dictionary of values to set on newly-created model instances.</li>
<li><strong>kwargs</strong> &#8211; Django-style filters specifying which model to get, and what values to apply to new instances.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A 2-tuple containing the model instance and a boolean indicating whether the instance was created.</p>
</td>
</tr>
</tbody>
</table>
<p>This function attempts to retrieve a model instance based on the provided filters. If no matching model can be found, a new model is created using the parameters specified by the filters and any values in the <code class="docutils literal"><span class="pre">defaults</span></code> dictionary.</p>
<p>Example <strong>without</strong> <code class="docutils literal"><span class="pre">get_or_create</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Without `get_or_create`, we might write:</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="s">&#39;John&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">last_name</span> <span class="o">==</span> <span class="s">&#39;Lennon&#39;</span><span class="p">))</span>
<span class="k">except</span> <span class="n">Person</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">first_name</span><span class="o">=</span><span class="s">&#39;John&#39;</span><span class="p">,</span>
        <span class="n">last_name</span><span class="o">=</span><span class="s">&#39;Lennon&#39;</span><span class="p">,</span>
        <span class="n">birthday</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
<p>Equivalent code using <code class="docutils literal"><span class="pre">get_or_create</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">person</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span>
    <span class="n">first_name</span><span class="o">=</span><span class="s">&#39;John&#39;</span><span class="p">,</span>
    <span class="n">last_name</span><span class="o">=</span><span class="s">&#39;Lennon&#39;</span><span class="p">,</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;birthday&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">)})</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.alias">
<em class="property">classmethod </em><code class="descname">alias</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.alias" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><code class="xref py py-class docutils literal"><span class="pre">ModelAlias</span></code> instance</td>
</tr>
</tbody>
</table>
<p>The <a class="reference internal" href="#Model.alias" title="Model.alias"><code class="xref py py-meth docutils literal"><span class="pre">alias()</span></code></a> method is used to create self-joins.</p>
<p>Example:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="go">Parent = Category.alias()</span>
<span class="go">sq = (Category</span>
<span class="go">      .select(Category, Parent)</span>
<span class="go">      .join(Parent, on=(Category.parent == Parent.id))</span>
<span class="go">      .where(Parent.name == &#39;parent category&#39;))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When using a <code class="xref py py-class docutils literal"><span class="pre">ModelAlias</span></code> in a join, you must explicitly specify the join condition.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.create_table">
<em class="property">classmethod </em><code class="descname">create_table</code><span class="sig-paren">(</span><span class="optional">[</span><em>fail_silently=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.create_table" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>fail_silently</strong> (<em>bool</em>) &#8211; If set to <code class="docutils literal"><span class="pre">True</span></code>, the method will check
for the existence of the table before attempting to create.</td>
</tr>
</tbody>
</table>
<p>Create the table for the given model, along with any constraints and indexes.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">database</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">SomeModel</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>  <span class="c"># Execute the create table query.</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.drop_table">
<em class="property">classmethod </em><code class="descname">drop_table</code><span class="sig-paren">(</span><span class="optional">[</span><em>fail_silently=False</em><span class="optional">[</span>, <em>cascade=False</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.drop_table" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>fail_silently</strong> (<em>bool</em>) &#8211; If set to <code class="docutils literal"><span class="pre">True</span></code>, the query will check for
the existence of the table before attempting to remove.</li>
<li><strong>cascade</strong> (<em>bool</em>) &#8211; Drop table with <code class="docutils literal"><span class="pre">CASCADE</span></code> option.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Drop the table for the given model.</p>
</dd></dl>

<dl class="classmethod">
<dt id="Model.table_exists">
<em class="property">classmethod </em><code class="descname">table_exists</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.table_exists" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">Boolean whether the table for this model exists in the database</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="Model.sqlall">
<em class="property">classmethod </em><code class="descname">sqlall</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.sqlall" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A list of queries required to create the table and indexes.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Model.save">
<code class="descname">save</code><span class="sig-paren">(</span><span class="optional">[</span><em>force_insert=False</em><span class="optional">[</span>, <em>only=None</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.save" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>force_insert</strong> (<em>bool</em>) &#8211; Whether to force execution of an insert</li>
<li><strong>only</strong> (<em>list</em>) &#8211; A list of fields to persist &#8211; when supplied, only the given
fields will be persisted.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Save the given instance, creating or updating depending on whether it has a
primary key.  If <code class="docutils literal"><span class="pre">force_insert=True</span></code> an <em>INSERT</em> will be issued regardless
of whether or not the primary key exists.</p>
<p>Example showing saving a model instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
<span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s">&#39;some-user&#39;</span>  <span class="c"># does not touch the database</span>
<span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c"># change is persisted to the db</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Model.delete_instance">
<code class="descname">delete_instance</code><span class="sig-paren">(</span><span class="optional">[</span><em>recursive=False</em><span class="optional">[</span>, <em>delete_nullable=False</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.delete_instance" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>recursive</strong> &#8211; Delete this instance and anything that depends on it,
optionally updating those that have nullable dependencies</li>
<li><strong>delete_nullable</strong> &#8211; If doing a recursive delete, delete all dependent
objects regardless of whether it could be updated to NULL</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Delete the given instance.  Any foreign keys set to cascade on
delete will be deleted automatically.  For more programmatic control,
you can call with recursive=True, which will delete any non-nullable
related models (those that <em>are</em> nullable will be set to NULL).  If you
wish to delete all dependencies regardless of whether they are nullable,
set <code class="docutils literal"><span class="pre">delete_nullable=True</span></code>.</p>
<p>example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">some_obj</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">()</span>  <span class="c"># it is gone forever</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Model.dependencies">
<code class="descname">dependencies</code><span class="sig-paren">(</span><span class="optional">[</span><em>search_nullable=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.dependencies" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>search_nullable</strong> (<em>bool</em>) &#8211; Search models related via a nullable foreign key</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">Generator expression yielding queries and foreign key fields</td>
</tr>
</tbody>
</table>
<p>Generate a list of queries of dependent models.  Yields a 2-tuple containing
the query and corresponding foreign key field.  Useful for searching dependencies
of a model, i.e. things that would be orphaned in the event of a delete.</p>
</dd></dl>

<dl class="attribute">
<dt id="Model.dirty_fields">
<code class="descname">dirty_fields</code><a class="headerlink" href="#Model.dirty_fields" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of fields that were manually set.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you just want to persist modified fields, you can call
<code class="docutils literal"><span class="pre">model.save(only=model.dirty_fields)</span></code>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Model.is_dirty">
<code class="descname">is_dirty</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.is_dirty" title="Permalink to this definition">¶</a></dt>
<dd><p>Return whether any fields were manually set.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">bool</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Model.prepared">
<code class="descname">prepared</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.prepared" title="Permalink to this definition">¶</a></dt>
<dd><p>This method provides a hook for performing model initialization <em>after</em>
the row data has been populated.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="fields">
<span id="fields-api"></span><h2>Fields<a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt>
<code class="descname">Field(null=False, index=False, unique=False, verbose_name=None, help_text=None, db_column=None, default=None, choices=None, primary_key=False, sequence=None, constraints=None, schema=None, **kwargs):</code></dt>
<dd><p>The base class from which all other field types extend.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>null</strong> (<em>bool</em>) &#8211; whether this column can accept <code class="docutils literal"><span class="pre">None</span></code> or <code class="docutils literal"><span class="pre">NULL</span></code> values</li>
<li><strong>index</strong> (<em>bool</em>) &#8211; whether to create an index for this column when creating the table</li>
<li><strong>unique</strong> (<em>bool</em>) &#8211; whether to create a unique index for this column when creating the table</li>
<li><strong>verbose_name</strong> (<em>string</em>) &#8211; specify a &#8220;verbose name&#8221; for this field, useful for metadata purposes</li>
<li><strong>help_text</strong> (<em>string</em>) &#8211; specify some instruction text for the usage/meaning of this field</li>
<li><strong>db_column</strong> (<em>string</em>) &#8211; column name to use for underlying storage, useful for compatibility with legacy databases</li>
<li><strong>default</strong> &#8211; a value to use as an uninitialized default</li>
<li><strong>choices</strong> &#8211; an iterable of 2-tuples mapping <code class="docutils literal"><span class="pre">value</span></code> to <code class="docutils literal"><span class="pre">display</span></code></li>
<li><strong>primary_key</strong> (<em>bool</em>) &#8211; whether to use this as the primary key for the table</li>
<li><strong>sequence</strong> (<em>string</em>) &#8211; name of sequence (if backend supports it)</li>
<li><strong>constraints</strong> (<em>list</em>) &#8211; a list of constraints, e.g. <code class="docutils literal"><span class="pre">[Check('price</span> <span class="pre">&gt;</span> <span class="pre">0')]</span></code>.</li>
<li><strong>schema</strong> (<em>string</em>) &#8211; name of schema (if backend supports it)</li>
<li><strong>kwargs</strong> &#8211; named attributes containing values that may pertain to specific field subclasses, such as &#8220;max_length&#8221; or &#8220;decimal_places&#8221;</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt>
<code class="descname">db_field = '&lt;some field type&gt;'</code></dt>
<dd><p>Attribute used to map this field to a column type, e.g. &#8220;string&#8221; or &#8220;datetime&#8221;</p>
</dd></dl>

<dl class="attribute">
<dt id="_is_bound">
<code class="descname">_is_bound</code><a class="headerlink" href="#_is_bound" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean flag indicating if the field is attached to a model class.</p>
</dd></dl>

<dl class="attribute">
<dt id="model_class">
<code class="descname">model_class</code><a class="headerlink" href="#model_class" title="Permalink to this definition">¶</a></dt>
<dd><p>The model the field belongs to. <em>Only applies to bound fields.</em></p>
</dd></dl>

<dl class="attribute">
<dt id="name">
<code class="descname">name</code><a class="headerlink" href="#name" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the field. <em>Only applies to bound fields.</em></p>
</dd></dl>

<dl class="method">
<dt id="db_value">
<code class="descname">db_value</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#db_value" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> &#8211; python data type to prep for storage in the database</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">converted python datatype</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="python_value">
<code class="descname">python_value</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#python_value" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> &#8211; data coming from the backend storage</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">python data type</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="coerce">
<code class="descname">coerce</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#coerce" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is a shorthand that is used, by default, by both <code class="docutils literal"><span class="pre">db_value</span></code> and
<code class="docutils literal"><span class="pre">python_value</span></code>.  You can usually get away with just implementing this.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> &#8211; arbitrary data from app or backend</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">python data type</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="IntegerField">
<em class="property">class </em><code class="descname">IntegerField</code><a class="headerlink" href="#IntegerField" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores: integers</p>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'int'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="BigIntegerField">
<em class="property">class </em><code class="descname">BigIntegerField</code><a class="headerlink" href="#BigIntegerField" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores: big integers</p>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'bigint'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="PrimaryKeyField">
<em class="property">class </em><code class="descname">PrimaryKeyField</code><a class="headerlink" href="#PrimaryKeyField" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores: auto-incrementing integer fields suitable for use as primary key.</p>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'primary_key'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="FloatField">
<em class="property">class </em><code class="descname">FloatField</code><a class="headerlink" href="#FloatField" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores: floating-point numbers</p>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'float'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="DoubleField">
<em class="property">class </em><code class="descname">DoubleField</code><a class="headerlink" href="#DoubleField" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores: double-precision floating-point numbers</p>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'double'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="DecimalField">
<em class="property">class </em><code class="descname">DecimalField</code><a class="headerlink" href="#DecimalField" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores: decimal numbers, using python standard library <code class="docutils literal"><span class="pre">Decimal</span></code> objects</p>
<p>Additional attributes and values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">max_digits</span></code></td>
<td><code class="docutils literal"><span class="pre">10</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">decimal_places</span></code></td>
<td><code class="docutils literal"><span class="pre">5</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">auto_round</span></code></td>
<td><code class="docutils literal"><span class="pre">False</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">rounding</span></code></td>
<td><code class="docutils literal"><span class="pre">decimal.DefaultContext.rounding</span></code></td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'decimal'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="CharField">
<em class="property">class </em><code class="descname">CharField</code><a class="headerlink" href="#CharField" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores: small strings (0-255 bytes)</p>
<p>Additional attributes and values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">max_length</span></code></td>
<td><code class="docutils literal"><span class="pre">255</span></code></td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'string'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="TextField">
<em class="property">class </em><code class="descname">TextField</code><a class="headerlink" href="#TextField" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores: arbitrarily large strings</p>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'text'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="DateTimeField">
<em class="property">class </em><code class="descname">DateTimeField</code><a class="headerlink" href="#DateTimeField" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores: python <code class="docutils literal"><span class="pre">datetime.datetime</span></code> instances</p>
<p>Accepts a special parameter <code class="docutils literal"><span class="pre">formats</span></code>, which contains a list of formats
the datetime can be encoded with.  The default behavior is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S.</span><span class="si">%f</span><span class="s">&#39;</span> <span class="c"># year-month-day hour-minute-second.microsecond</span>
<span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span> <span class="c"># year-month-day hour-minute-second</span>
<span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span> <span class="c"># year-month-day</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the incoming value does not match a format, it will be returned as-is</p>
</div>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'datetime'</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="DateTimeField.year">
<code class="descname">year</code><a class="headerlink" href="#DateTimeField.year" title="Permalink to this definition">¶</a></dt>
<dd><p>An expression suitable for extracting the year, for example to retrieve
all blog posts from 2013:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Blog</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Blog</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2013</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="DateTimeField.month">
<code class="descname">month</code><a class="headerlink" href="#DateTimeField.month" title="Permalink to this definition">¶</a></dt>
<dd><p>An expression suitable for extracting the month from a stored date.</p>
</dd></dl>

<dl class="attribute">
<dt id="DateTimeField.day">
<code class="descname">day</code><a class="headerlink" href="#DateTimeField.day" title="Permalink to this definition">¶</a></dt>
<dd><p>An expression suitable for extracting the day from a stored date.</p>
</dd></dl>

<dl class="attribute">
<dt id="DateTimeField.hour">
<code class="descname">hour</code><a class="headerlink" href="#DateTimeField.hour" title="Permalink to this definition">¶</a></dt>
<dd><p>An expression suitable for extracting the hour from a stored time.</p>
</dd></dl>

<dl class="attribute">
<dt id="DateTimeField.minute">
<code class="descname">minute</code><a class="headerlink" href="#DateTimeField.minute" title="Permalink to this definition">¶</a></dt>
<dd><p>An expression suitable for extracting the minute from a stored time.</p>
</dd></dl>

<dl class="attribute">
<dt id="DateTimeField.second">
<code class="descname">second</code><a class="headerlink" href="#DateTimeField.second" title="Permalink to this definition">¶</a></dt>
<dd><p>An expression suitable for extracting the second from a stored time.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="DateField">
<em class="property">class </em><code class="descname">DateField</code><a class="headerlink" href="#DateField" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores: python <code class="docutils literal"><span class="pre">datetime.date</span></code> instances</p>
<p>Accepts a special parameter <code class="docutils literal"><span class="pre">formats</span></code>, which contains a list of formats
the date can be encoded with.  The default behavior is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span> <span class="c"># year-month-day</span>
<span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span> <span class="c"># year-month-day hour-minute-second</span>
<span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S.</span><span class="si">%f</span><span class="s">&#39;</span> <span class="c"># year-month-day hour-minute-second.microsecond</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the incoming value does not match a format, it will be returned as-is</p>
</div>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'date'</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="DateField.year">
<code class="descname">year</code><a class="headerlink" href="#DateField.year" title="Permalink to this definition">¶</a></dt>
<dd><p>An expression suitable for extracting the year, for example to retrieve
all people born in 1980:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Person</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">dob</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">1983</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="DateField.month">
<code class="descname">month</code><a class="headerlink" href="#DateField.month" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as <a class="reference internal" href="#DateField.year" title="DateField.year"><code class="xref py py-attr docutils literal"><span class="pre">year</span></code></a>, except extract month.</p>
</dd></dl>

<dl class="attribute">
<dt id="DateField.day">
<code class="descname">day</code><a class="headerlink" href="#DateField.day" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as <a class="reference internal" href="#DateField.year" title="DateField.year"><code class="xref py py-attr docutils literal"><span class="pre">year</span></code></a>, except extract day.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="TimeField">
<em class="property">class </em><code class="descname">TimeField</code><a class="headerlink" href="#TimeField" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores: python <code class="docutils literal"><span class="pre">datetime.time</span></code> instances</p>
<p>Accepts a special parameter <code class="docutils literal"><span class="pre">formats</span></code>, which contains a list of formats
the time can be encoded with.  The default behavior is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;%H:%M:%S.</span><span class="si">%f</span><span class="s">&#39;</span> <span class="c"># hour:minute:second.microsecond</span>
<span class="s">&#39;%H:%M:%S&#39;</span> <span class="c"># hour:minute:second</span>
<span class="s">&#39;%H:%M&#39;</span> <span class="c"># hour:minute</span>
<span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S.</span><span class="si">%f</span><span class="s">&#39;</span> <span class="c"># year-month-day hour-minute-second.microsecond</span>
<span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span> <span class="c"># year-month-day hour-minute-second</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the incoming value does not match a format, it will be returned as-is</p>
</div>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'time'</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="TimeField.hour">
<code class="descname">hour</code><a class="headerlink" href="#TimeField.hour" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract the hour from a time, for example to retreive all events
occurring in the evening:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Event</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Event</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="mi">17</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="TimeField.minute">
<code class="descname">minute</code><a class="headerlink" href="#TimeField.minute" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as <a class="reference internal" href="#TimeField.hour" title="TimeField.hour"><code class="xref py py-attr docutils literal"><span class="pre">hour</span></code></a>, except extract minute.</p>
</dd></dl>

<dl class="attribute">
<dt id="TimeField.second">
<code class="descname">second</code><a class="headerlink" href="#TimeField.second" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as <a class="reference internal" href="#TimeField.hour" title="TimeField.hour"><code class="xref py py-attr docutils literal"><span class="pre">hour</span></code></a>, except extract second..</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="BooleanField">
<em class="property">class </em><code class="descname">BooleanField</code><a class="headerlink" href="#BooleanField" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores: <code class="docutils literal"><span class="pre">True</span></code> / <code class="docutils literal"><span class="pre">False</span></code></p>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'bool'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="BlobField">
<em class="property">class </em><code class="descname">BlobField</code><a class="headerlink" href="#BlobField" title="Permalink to this definition">¶</a></dt>
<dd><p>Store arbitrary binary data.</p>
</dd></dl>

<dl class="class">
<dt id="UUIDField">
<em class="property">class </em><code class="descname">UUIDField</code><a class="headerlink" href="#UUIDField" title="Permalink to this definition">¶</a></dt>
<dd><p>Store <code class="docutils literal"><span class="pre">UUID</span></code> values.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently this field is only supported by <a class="reference internal" href="#PostgresqlDatabase" title="PostgresqlDatabase"><code class="xref py py-class docutils literal"><span class="pre">PostgresqlDatabase</span></code></a>.</p>
</div>
</dd></dl>

<dl class="class">
<dt id="ForeignKeyField">
<em class="property">class </em><code class="descname">ForeignKeyField</code><span class="sig-paren">(</span><em>rel_model</em><span class="optional">[</span>, <em>related_name=None</em><span class="optional">[</span>, <em>on_delete=None</em><span class="optional">[</span>, <em>on_update=None</em><span class="optional">[</span>, <em>to_field=None</em><span class="optional">[</span>, <em>...</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#ForeignKeyField" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores: relationship to another model</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>rel_model</strong> &#8211; related <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> class or the string &#8216;self&#8217; if declaring a self-referential foreign key</li>
<li><strong>related_name</strong> (<em>string</em>) &#8211; attribute to expose on related model</li>
<li><strong>on_delete</strong> (<em>string</em>) &#8211; on delete behavior, e.g. <code class="docutils literal"><span class="pre">on_delete='CASCADE'</span></code>.</li>
<li><strong>on_update</strong> (<em>string</em>) &#8211; on update behavior.</li>
<li><strong>to_field</strong> &#8211; the field (or field name) on <code class="docutils literal"><span class="pre">rel_model</span></code> the foreign key
references. Defaults to the primary key field for <code class="docutils literal"><span class="pre">rel_model</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Tweet</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;tweets&#39;</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>

<span class="c"># &quot;user&quot; attribute</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">some_tweet</span><span class="o">.</span><span class="n">user</span>
<span class="o">&lt;</span><span class="n">User</span><span class="p">:</span> <span class="n">charlie</span><span class="o">&gt;</span>

<span class="c"># &quot;tweets&quot; related name attribute</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">charlie</span><span class="o">.</span><span class="n">tweets</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">print</span> <span class="n">tweet</span><span class="o">.</span><span class="n">content</span>
<span class="n">Some</span> <span class="n">tweet</span>
<span class="n">Another</span> <span class="n">tweet</span>
<span class="n">Yet</span> <span class="n">another</span> <span class="n">tweet</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Foreign keys do not have a particular <code class="docutils literal"><span class="pre">db_field</span></code> as they will
take their field type depending on the type of primary key on the model they are
related to.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you manually specify a <code class="docutils literal"><span class="pre">to_field</span></code>, that field must be either
a primary key or have a unique constraint.</p>
</div>
</dd></dl>

<dl class="class">
<dt id="CompositeKey">
<em class="property">class </em><code class="descname">CompositeKey</code><span class="sig-paren">(</span><em>*fields</em><span class="sig-paren">)</span><a class="headerlink" href="#CompositeKey" title="Permalink to this definition">¶</a></dt>
<dd><p>Specify a composite primary key for a model.  Unlike the other fields, a
composite key is defined in the model&#8217;s <code class="docutils literal"><span class="pre">Meta</span></code> class after the fields
have been defined.  It takes as parameters the string names of the fields
to use as the primary key:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">BlogTagThrough</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;tags&#39;</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;blogs&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">primary_key</span> <span class="o">=</span> <span class="n">CompositeKey</span><span class="p">(</span><span class="s">&#39;blog&#39;</span><span class="p">,</span> <span class="s">&#39;tag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="query-types">
<span id="id1"></span><h2>Query Types<a class="headerlink" href="#query-types" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="Query">
<em class="property">class </em><code class="descname">Query</code><a class="headerlink" href="#Query" title="Permalink to this definition">¶</a></dt>
<dd><p>The parent class from which all other query classes are drived. While you
will not deal with <a class="reference internal" href="#Query" title="Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a> directly in your code, it implements some
methods that are common across all query types.</p>
<dl class="method">
<dt id="Query.where">
<code class="descname">where</code><span class="sig-paren">(</span><em>*expressions</em><span class="sig-paren">)</span><a class="headerlink" href="#Query.where" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>expressions</strong> &#8211; a list of one or more expressions</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">a <a class="reference internal" href="#Query" title="Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a> instance</td>
</tr>
</tbody>
</table>
<p>Example selection users where the username is equal to &#8216;somebody&#8217;:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sq</span> <span class="o">=</span> <span class="n">SelectQuery</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s">&#39;somebody&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example selecting tweets made by users who are either editors or administrators:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sq</span> <span class="o">=</span> <span class="n">SelectQuery</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">is_editor</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span> <span class="o">|</span>
    <span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">is_admin</span> <span class="o">==</span> <span class="bp">True</span><span class="p">))</span>
</pre></div>
</div>
<p>Example of deleting tweets by users who are no longer active:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">dq</span> <span class="o">=</span> <span class="n">DeleteQuery</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">Tweet</span><span class="o">.</span><span class="n">user</span> <span class="o">&lt;&lt;</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">False</span><span class="p">))</span>
<span class="n">dq</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c"># perform the delete query</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="xref py py-meth docutils literal"><span class="pre">where()</span></code> calls are chainable.  Multiple calls will
be &#8220;AND&#8221;-ed together.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Query.join">
<code class="descname">join</code><span class="sig-paren">(</span><em>model</em>, <em>join_type=None</em>, <em>on=None</em><span class="sig-paren">)</span><a class="headerlink" href="#Query.join" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>model</strong> &#8211; the model to join on.  there must be a <a class="reference internal" href="#ForeignKeyField" title="ForeignKeyField"><code class="xref py py-class docutils literal"><span class="pre">ForeignKeyField</span></code></a> between
the current <code class="docutils literal"><span class="pre">query</span> <span class="pre">context</span></code> and the model passed in.</li>
<li><strong>join_type</strong> &#8211; allows the type of <code class="docutils literal"><span class="pre">JOIN</span></code> used to be specified explicitly,
one of <code class="docutils literal"><span class="pre">JOIN.INNER</span></code>, <code class="docutils literal"><span class="pre">JOIN.LEFT_OUTER</span></code>, <code class="docutils literal"><span class="pre">JOIN.FULL</span></code></li>
<li><strong>on</strong> &#8211; if multiple foreign keys exist between two models, this parameter
is the ForeignKeyField to join on.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">a <a class="reference internal" href="#Query" title="Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a> instance</p>
</td>
</tr>
</tbody>
</table>
<p>Generate a <code class="docutils literal"><span class="pre">JOIN</span></code> clause from the current <code class="docutils literal"><span class="pre">query</span> <span class="pre">context</span></code> to the <code class="docutils literal"><span class="pre">model</span></code> passed
in, and establishes <code class="docutils literal"><span class="pre">model</span></code> as the new <code class="docutils literal"><span class="pre">query</span> <span class="pre">context</span></code>.</p>
<p>Example selecting tweets and joining on user in order to restrict to
only those tweets made by &#8220;admin&#8221; users:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sq</span> <span class="o">=</span> <span class="n">SelectQuery</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">is_admin</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Example selecting users and joining on a particular foreign key field.
See the <a class="reference internal" href="example.html#example-app"><span>example app</span></a> for a real-life usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sq</span> <span class="o">=</span> <span class="n">SelectQuery</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Relationship</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">Relationship</span><span class="o">.</span><span class="n">to_user</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Query.switch">
<code class="descname">switch</code><span class="sig-paren">(</span><em>model</em><span class="sig-paren">)</span><a class="headerlink" href="#Query.switch" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>model</strong> &#8211; model to switch the <code class="docutils literal"><span class="pre">query</span> <span class="pre">context</span></code> to.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">a clone of the query with a new query context</td>
</tr>
</tbody>
</table>
<p>Switches the <code class="docutils literal"><span class="pre">query</span> <span class="pre">context</span></code> to the given model.  Raises an exception if the
model has not been selected or joined on previously.  Useful for performing
multiple joins from a single table.</p>
<p>The following example selects from blog and joins on both entry and user:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sq</span> <span class="o">=</span> <span class="n">SelectQuery</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Entry</span><span class="p">)</span><span class="o">.</span><span class="n">switch</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Query.alias">
<code class="descname">alias</code><span class="sig-paren">(</span><em>alias=None</em><span class="sig-paren">)</span><a class="headerlink" href="#Query.alias" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>alias</strong> (<em>str</em>) &#8211; A string to alias the result of this query</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">a Query instance</td>
</tr>
</tbody>
</table>
<p>Assign an alias to given query, which can be used as part of a subquery.</p>
</dd></dl>

<dl class="method">
<dt id="Query.sql">
<code class="descname">sql</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Query.sql" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">a 2-tuple containing the appropriate SQL query and a tuple of parameters</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Query.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Query.execute" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute the given query</p>
</dd></dl>

<dl class="method">
<dt id="Query.scalar">
<code class="descname">scalar</code><span class="sig-paren">(</span><span class="optional">[</span><em>as_tuple=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Query.scalar" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>as_tuple</strong> (<em>bool</em>) &#8211; return the row as a tuple or a single value</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">the resulting row, either as a single value or tuple</td>
</tr>
</tbody>
</table>
<p>Provide a way to retrieve single values from select queries, for instance
when performing an aggregation.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">PageView</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Distinct</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">url</span><span class="p">)))</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>
<span class="go">100 # &lt;-- there are 100 distinct URLs in the pageview table</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="SelectQuery">
<em class="property">class </em><code class="descname">SelectQuery</code><span class="sig-paren">(</span><em>model_class</em>, <em>*selection</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery" title="Permalink to this definition">¶</a></dt>
<dd><p>By far the most complex of the query classes available in peewee. It supports
all clauses commonly associated with select queries.</p>
<p>Methods on the select query can be chained together.</p>
<p><code class="docutils literal"><span class="pre">SelectQuery</span></code> implements an <a class="reference internal" href="#SelectQuery.__iter__" title="SelectQuery.__iter__"><code class="xref py py-meth docutils literal"><span class="pre">__iter__()</span></code></a> method, allowing it to be iterated
to return model instances.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>model</strong> &#8211; a <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> class to perform query on</li>
<li><strong>selection</strong> &#8211; a list of models, fields, functions or expressions</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>If no selection is provided, it will default to all the fields of the given
model.</p>
<p>Example selecting some user instances from the database.  Only the <code class="docutils literal"><span class="pre">id</span></code>
and <code class="docutils literal"><span class="pre">username</span></code> columns are selected.  When iterated, will return instances
of the <code class="docutils literal"><span class="pre">User</span></code> model:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sq</span> <span class="o">=</span> <span class="n">SelectQuery</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">sq</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span>
</pre></div>
</div>
<p>Example selecting users and additionally the number of tweets made by the user.
The <code class="docutils literal"><span class="pre">User</span></code> instances returned will have an additional attribute, &#8216;count&#8217;, that
corresponds to the number of tweets made:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">SelectQuery</span><span class="p">(</span>
    <span class="n">User</span><span class="p">,</span> <span class="n">User</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;count&#39;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span>
    <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="p">))</span>
</pre></div>
</div>
<dl class="method">
<dt id="SelectQuery.select">
<code class="descname">select</code><span class="sig-paren">(</span><em>*selection</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.select" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>selection</strong> &#8211; a list of expressions, which can be model classes or fields.
if left blank, will default to all the fields of the given model.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Usually the selection will be specified when the instance is created.
This method simply exists for the case when you want to modify the
SELECT clause independent of instantiating a query.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">query</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.from_">
<code class="descname">from_</code><span class="sig-paren">(</span><em>*args</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.from_" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>args</strong> &#8211; one or more expressions, for example <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a>
or <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> instance(s). if left blank, will default
to the table of the given model.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># rather than a join, select from both tables and join with where.</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">from_</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Blog</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Blog</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.group_by">
<code class="descname">group_by</code><span class="sig-paren">(</span><em>*clauses</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.group_by" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>clauses</strong> &#8211; a list of expressions, which can be model classes or individual field instances</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Group by one or more columns.  If a model class is provided, all the fields
on that model class will be used.</p>
<p>Example selecting users, joining on tweets, and grouping by the user so
a count of tweets can be calculated for each user:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;count&#39;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span>
    <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.having">
<code class="descname">having</code><span class="sig-paren">(</span><em>*expressions</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.having" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>expressions</strong> &#8211; a list of one or more expressions</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Here is the above example selecting users and tweet counts, but restricting
the results to those users who have created 100 or more tweets:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;count&#39;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span>
    <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="o">.</span><span class="n">having</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.order_by">
<code class="descname">order_by</code><span class="sig-paren">(</span><em>*clauses</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.order_by" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>clauses</strong> &#8211; a list of fields, calls to <code class="docutils literal"><span class="pre">field.[asc|desc]()</span></code> or one or more expressions</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Example of ordering users by username:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
</pre></div>
</div>
<p>Example of selecting tweets and ordering them first by user, then newest
first:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tweet</span>
         <span class="o">.</span><span class="n">select</span><span class="p">()</span>
         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span>
             <span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
             <span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span><span class="o">.</span><span class="n">desc</span><span class="p">()))</span>
</pre></div>
</div>
<p>You can also use <code class="docutils literal"><span class="pre">+</span></code> and <code class="docutils literal"><span class="pre">-</span></code> prefixes to indicate ascending or descending order if you prefer:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tweet</span>
         <span class="o">.</span><span class="n">select</span><span class="p">()</span>
         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span>
             <span class="o">+</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
             <span class="o">-</span><span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span><span class="p">))</span>
</pre></div>
</div>
<p>A more complex example ordering users by the number of tweets made (greatest
to least), then ordered by username in the event of a tie:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">tweet_ct</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">tweet_ct</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;count&#39;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span>
    <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">tweet_ct</span><span class="o">.</span><span class="n">desc</span><span class="p">(),</span> <span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.window">
<code class="descname">window</code><span class="sig-paren">(</span><em>*windows</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.window" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>windows</strong> (<a class="reference internal" href="#Window" title="Window"><em>Window</em></a>) &#8211; One or more <a class="reference internal" href="#Window" title="Window"><code class="xref py py-class docutils literal"><span class="pre">Window</span></code></a> instances.</td>
</tr>
</tbody>
</table>
<p>Add one or more window definitions to this query.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="p">(</span><span class="n">partition_by</span><span class="o">=</span><span class="p">[</span><span class="n">fn</span><span class="o">.</span><span class="n">date_trunc</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">,</span> <span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)])</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">PageView</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span>
             <span class="n">PageView</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
             <span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
             <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">))</span>
         <span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.limit">
<code class="descname">limit</code><span class="sig-paren">(</span><em>num</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.limit" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>num</strong> (<em>int</em>) &#8211; limit results to <code class="docutils literal"><span class="pre">num</span></code> rows</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.offset">
<code class="descname">offset</code><span class="sig-paren">(</span><em>num</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.offset" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>num</strong> (<em>int</em>) &#8211; offset results by <code class="docutils literal"><span class="pre">num</span></code> rows</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.paginate">
<code class="descname">paginate</code><span class="sig-paren">(</span><em>page_num</em>, <em>paginate_by=20</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.paginate" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>page_num</strong> &#8211; a 1-based page number to use for paginating results</li>
<li><strong>paginate_by</strong> &#8211; number of results to return per-page</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>Shorthand for applying a <code class="docutils literal"><span class="pre">LIMIT</span></code> and <code class="docutils literal"><span class="pre">OFFSET</span></code> to the query.</p>
<p>Page indices are <strong>1-based</strong>, so page 1 is the first page.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>  <span class="c"># get users 41-60</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.distinct">
<code class="descname">distinct</code><span class="sig-paren">(</span><span class="optional">[</span><em>is_distinct=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.distinct" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>is_distinct</strong> &#8211; See notes.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Indicates that this query should only return distinct rows. Results in a
<code class="docutils literal"><span class="pre">SELECT</span> <span class="pre">DISTINCT</span></code> query.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The value for <code class="docutils literal"><span class="pre">is_distinct</span></code> should either be a boolean, in which
case the query will (or won&#8217;t) be <cite>DISTINCT</cite>.</p>
<p class="last">You can specify a list of one or more expressions to generate a
<code class="docutils literal"><span class="pre">DISTINCT</span> <span class="pre">ON</span></code> query, e.g. <code class="docutils literal"><span class="pre">.distinct([Model.col1,</span> <span class="pre">Model.col2])</span></code>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.for_update">
<code class="descname">for_update</code><span class="sig-paren">(</span><span class="optional">[</span><em>for_update=True</em><span class="optional">[</span>, <em>nowait=False</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.for_update" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Indicate that this query should lock rows for update.  If <code class="docutils literal"><span class="pre">nowait</span></code> is
<code class="docutils literal"><span class="pre">True</span></code> then the database will raise an <code class="docutils literal"><span class="pre">OperationalError</span></code> if it
cannot obtain the lock.</p>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.naive">
<code class="descname">naive</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.naive" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Flag this query indicating it should only attempt to reconstruct a single model
instance for every row returned by the cursor.  If multiple tables were queried,
the columns returned are patched directly onto the single model instance.</p>
<p>Generally this method is useful for speeding up the time needed to construct
model instances given a database cursor.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this can provide a significant speed improvement when doing simple
iteration over a large result set.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.iterator">
<code class="descname">iterator</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.iterator" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><code class="docutils literal"><span class="pre">iterable</span></code></td>
</tr>
</tbody>
</table>
<p>By default peewee will cache rows returned by the cursor.  This is to
prevent things like multiple iterations, slicing and indexing from
triggering extra queries.  When you are iterating over a large number
of rows, however, this cache can take up a lot of memory. Using <code class="docutils literal"><span class="pre">iterator()</span></code>
will save memory by not storing all the returned model instances.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># iterate over large number of rows.</span>
<span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">Stats</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">iterator</span><span class="p">():</span>
    <span class="c"># do something.</span>
    <span class="k">pass</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.tuples">
<code class="descname">tuples</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.tuples" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Flag this query indicating it should simply return raw tuples from the cursor.
This method is useful when you either do not want or do not need full model
instances.</p>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.dicts">
<code class="descname">dicts</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.dicts" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Flag this query indicating it should simply return dictionaries from the cursor.
This method is useful when you either do not want or do not need full model
instances.</p>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.aggregate_rows">
<code class="descname">aggregate_rows</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.aggregate_rows" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>This method provides one way to avoid the <strong>N+1</strong> query problem.</p>
<p>Consider a webpage where you wish to display a list of users and all of their
associated tweets. You could approach this problem by listing the users, then
for each user executing a separate query to retrieve their tweets. This is the
<strong>N+1</strong> behavior, because the number of queries varies depending on the number
of users. Conventional wisdom is that it is preferable to execute fewer queries.
Peewee provides several ways to avoid this problem.</p>
<p>You can use the <a class="reference internal" href="#prefetch" title="prefetch"><code class="xref py py-func docutils literal"><span class="pre">prefetch()</span></code></a> helper, which uses <code class="docutils literal"><span class="pre">IN</span></code> clauses to retrieve
the tweets for the listed users.</p>
<p>Another method is to select both the user and the tweet data in a single query,
then de-dupe the users, aggregating the tweets in the process.</p>
<p>The raw column data might appear like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># user.id, user.username, tweet.id, tweet.user_id, tweet.message</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span>        <span class="s">&#39;charlie&#39;</span><span class="p">,</span>     <span class="mi">1</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>             <span class="s">&#39;hello&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span>        <span class="s">&#39;charlie&#39;</span><span class="p">,</span>     <span class="mi">2</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>             <span class="s">&#39;goodbye&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span>        <span class="s">&#39;no-tweets&#39;</span><span class="p">,</span>   <span class="n">NULL</span><span class="p">,</span>     <span class="n">NULL</span><span class="p">,</span>          <span class="n">NULL</span><span class="p">],</span>
<span class="p">[</span><span class="mi">3</span><span class="p">,</span>        <span class="s">&#39;huey&#39;</span><span class="p">,</span>        <span class="mi">3</span><span class="p">,</span>        <span class="mi">3</span><span class="p">,</span>             <span class="s">&#39;meow&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="mi">3</span><span class="p">,</span>        <span class="s">&#39;huey&#39;</span><span class="p">,</span>        <span class="mi">4</span><span class="p">,</span>        <span class="mi">3</span><span class="p">,</span>             <span class="s">&#39;purr&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="mi">3</span><span class="p">,</span>        <span class="s">&#39;huey&#39;</span><span class="p">,</span>        <span class="mi">5</span><span class="p">,</span>        <span class="mi">3</span><span class="p">,</span>             <span class="s">&#39;hiss&#39;</span><span class="p">],</span>
</pre></div>
</div>
<p>We can infer from the <code class="docutils literal"><span class="pre">JOIN</span></code> clause that the user data will be duplicated, and
therefore by de-duping the users, we can collect their tweets in one go and iterate
over the users and tweets transparently.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Tweet</span><span class="p">)</span>
         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">JOIN</span><span class="o">.</span><span class="n">LEFT_OUTER</span><span class="p">)</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
         <span class="o">.</span><span class="n">aggregate_rows</span><span class="p">())</span>  <span class="c"># .aggregate_rows() tells peewee to de-dupe the rows.</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span>
    <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">tweets</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;  &#39;</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">message</span>

<span class="c"># Producing the following output:</span>
<span class="n">charlie</span>
   <span class="n">hello</span>
   <span class="n">goodbye</span>
<span class="n">huey</span>
   <span class="n">meow</span>
   <span class="n">purr</span>
   <span class="n">hiss</span>
<span class="n">no</span><span class="o">-</span><span class="n">tweets</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Be sure that you specify an <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code> clause that ensures duplicated data
will appear in consecutive rows.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can specify arbitrarily complex joins, though for more complex queries
it may be more efficient to use <a class="reference internal" href="#prefetch" title="prefetch"><code class="xref py py-func docutils literal"><span class="pre">prefetch()</span></code></a>. In short, try both and
see what works best for your data-set.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For more information, see the <a class="reference internal" href="querying.html#nplusone"><span>Avoiding N+1 queries</span></a> document and the <a class="reference internal" href="querying.html#aggregate-rows"><span>Using aggregate_rows</span></a> sub-section.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.annotate">
<code class="descname">annotate</code><span class="sig-paren">(</span><em>related_model</em>, <em>aggregation=None</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.annotate" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>related_model</strong> &#8211; related <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> on which to perform aggregation,
must be linked by <a class="reference internal" href="#ForeignKeyField" title="ForeignKeyField"><code class="xref py py-class docutils literal"><span class="pre">ForeignKeyField</span></code></a>.</li>
<li><strong>aggregation</strong> &#8211; the type of aggregation to use, e.g. <code class="docutils literal"><span class="pre">fn.Count(Tweet.id).alias('count')</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>Annotate a query with an aggregation performed on a related model, for example,
&#8220;get a list of users with the number of tweets for each&#8221;:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="docutils literal"><span class="pre">aggregation</span></code> is None, it will default to <code class="docutils literal"><span class="pre">fn.Count(related_model.id).alias('count')</span></code>
but can be anything:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">user_latest</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Max</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;latest&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If the <code class="docutils literal"><span class="pre">ForeignKeyField</span></code> is <code class="docutils literal"><span class="pre">nullable</span></code>, then a <code class="docutils literal"><span class="pre">LEFT</span> <span class="pre">OUTER</span></code> join
may need to be used:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
         <span class="o">.</span><span class="n">select</span><span class="p">()</span>
         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">JOIN</span><span class="o">.</span><span class="n">LEFT_OUTER</span><span class="p">)</span>
         <span class="o">.</span><span class="n">switch</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>  <span class="c"># Switch query context back to `User`.</span>
         <span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">Tweet</span><span class="p">))</span>
</pre></div>
</div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.aggregate">
<code class="descname">aggregate</code><span class="sig-paren">(</span><em>aggregation</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.aggregate" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>aggregation</strong> &#8211; a function specifying what aggregation to perform, for
example <code class="docutils literal"><span class="pre">fn.Max(Tweet.created_date)</span></code>.</td>
</tr>
</tbody>
</table>
<p>Method to look at an aggregate of rows using a given function and
return a scalar value, such as the count of all rows or the average
value of a particular column.</p>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.count">
<code class="descname">count</code><span class="sig-paren">(</span><span class="optional">[</span><em>clear_limit=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.count" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>clear_limit</strong> (<em>bool</em>) &#8211; Remove any limit or offset clauses from the query before counting.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">an integer representing the number of rows in the current query</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the query has a GROUP BY, DISTINCT, LIMIT, or OFFSET
clause, then the <a class="reference internal" href="#SelectQuery.wrapped_count" title="SelectQuery.wrapped_count"><code class="xref py py-meth docutils literal"><span class="pre">wrapped_count()</span></code></a> method
will be used instead.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">sq</span> <span class="o">=</span> <span class="n">SelectQuery</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sq</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">45  # number of tweets</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deleted_tweets</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">DELETED</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deleted_tweets</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">3  # number of tweets that are marked as deleted</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.wrapped_count">
<code class="descname">wrapped_count</code><span class="sig-paren">(</span><span class="optional">[</span><em>clear_limit=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.wrapped_count" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>clear_limit</strong> (<em>bool</em>) &#8211; Remove any limit or offset clauses from the query before counting.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">an integer representing the number of rows in the current query</td>
</tr>
</tbody>
</table>
<p>Wrap the count query in a subquery.  Additional overhead but will give
correct counts when performing <code class="docutils literal"><span class="pre">DISTINCT</span></code> queries or those with <code class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></code>
clauses.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference internal" href="#SelectQuery.count" title="SelectQuery.count"><code class="xref py py-meth docutils literal"><span class="pre">count()</span></code></a> will automatically default to <a class="reference internal" href="#SelectQuery.wrapped_count" title="SelectQuery.wrapped_count"><code class="xref py py-meth docutils literal"><span class="pre">wrapped_count()</span></code></a>
in the event the query is distinct or has a grouping.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.exists">
<code class="descname">exists</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.exists" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">boolean whether the current query will return any rows.  uses an
optimized lookup, so use this rather than <a class="reference internal" href="#SelectQuery.get" title="SelectQuery.get"><code class="xref py py-meth docutils literal"><span class="pre">get()</span></code></a>.</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sq</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
<span class="k">if</span> <span class="n">sq</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">username</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">authenticated</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.get">
<code class="descname">get</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.get" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> instance or raises <code class="docutils literal"><span class="pre">DoesNotExist</span></code> exception</td>
</tr>
</tbody>
</table>
<p>Get a single row from the database that matches the given query.  Raises a
<code class="docutils literal"><span class="pre">&lt;model-class&gt;.DoesNotExist</span></code> if no rows are returned:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">active</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">active</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="k">except</span> <span class="n">User</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</div>
<p>This method is also exposed via the <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> api, in which case it
accepts arguments that are translated to the where clause:</p>
<blockquote>
<div>user = User.get(User.active == True, User.username == username)</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.first">
<code class="descname">first</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.first" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> instance or <code class="docutils literal"><span class="pre">None</span></code> if no results</td>
</tr>
</tbody>
</table>
<p>Fetch the first row from a query. The result will be cached in case the entire
query result-set should be iterated later.</p>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.execute" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><code class="xref py py-class docutils literal"><span class="pre">QueryResultWrapper</span></code></td>
</tr>
</tbody>
</table>
<p>Executes the query and returns a <code class="xref py py-class docutils literal"><span class="pre">QueryResultWrapper</span></code> for iterating over
the result set.  The results are managed internally by the query and whenever
a clause is added that would possibly alter the result set, the query is
marked for re-execution.</p>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.__iter__">
<code class="descname">__iter__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.__iter__" title="Permalink to this definition">¶</a></dt>
<dd><p>Executes the query and returns populated model instances:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.__getitem__">
<code class="descname">__getitem__</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.__getitem__" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> &#8211; Either an index or a <code class="docutils literal"><span class="pre">slice</span></code> object.</td>
</tr>
</tbody>
</table>
<p>Return the model instance(s) at the requested indices. To get the first
model, for instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">query</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
<span class="n">first_user</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">first_five</span> <span class="o">=</span> <span class="n">query</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.__or__">
<code class="descname">__or__</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.__or__" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>rhs</strong> &#8211; Either a <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> or a <a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
</tbody>
</table>
<p>Create a <code class="docutils literal"><span class="pre">UNION</span></code> query with the right-hand object. The result will contain all values from both the left and right queries.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">customers</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&#39;KS&#39;</span><span class="p">)</span>
<span class="n">stores</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&#39;KS&#39;</span><span class="p">)</span>

<span class="c"># Get all cities in kansas where we have either a customer or a store.</span>
<span class="n">all_cities</span> <span class="o">=</span> <span class="p">(</span><span class="n">customers</span> <span class="o">|</span> <span class="n">stores</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">SQL</span><span class="p">(</span><span class="s">&#39;city&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">SQLite does not allow <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code> or <code class="docutils literal"><span class="pre">LIMIT</span></code> clauses on the components of a compound query, however SQLite does allow these clauses on the final, compound result. This applies to <code class="docutils literal"><span class="pre">UNION</span> <span class="pre">(ALL)</span></code>, <code class="docutils literal"><span class="pre">INTERSECT</span></code>, and <code class="docutils literal"><span class="pre">EXCEPT</span></code>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.__and__">
<code class="descname">__and__</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.__and__" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>rhs</strong> &#8211; Either a <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> or a <a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
</tbody>
</table>
<p>Create an <code class="docutils literal"><span class="pre">INTERSECT</span></code> query. The result will contain values that are in
both the left and right queries.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">customers</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&#39;KS&#39;</span><span class="p">)</span>
<span class="n">stores</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&#39;KS&#39;</span><span class="p">)</span>

<span class="c"># Get all cities in kanasas where we have both customers and stores.</span>
<span class="n">cities</span> <span class="o">=</span> <span class="p">(</span><span class="n">customers</span> <span class="o">&amp;</span> <span class="n">stores</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">SQL</span><span class="p">(</span><span class="s">&#39;city&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.__sub__">
<code class="descname">__sub__</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.__sub__" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>rhs</strong> &#8211; Either a <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> or a <a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
</tbody>
</table>
<p>Create an <code class="docutils literal"><span class="pre">EXCEPT</span></code> query. The result will contain values that are in
the left-hand query but not in the right-hand query.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">customers</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&#39;KS&#39;</span><span class="p">)</span>
<span class="n">stores</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&#39;KS&#39;</span><span class="p">)</span>

<span class="c"># Get all cities in kanasas where we have customers but no stores.</span>
<span class="n">cities</span> <span class="o">=</span> <span class="p">(</span><span class="n">customers</span> <span class="o">-</span> <span class="n">stores</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">SQL</span><span class="p">(</span><span class="s">&#39;city&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.__xor__">
<code class="descname">__xor__</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.__xor__" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>rhs</strong> &#8211; Either a <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> or a <a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
</tbody>
</table>
<p>Create an symmetric difference query. The result will contain values
that are in either the left-hand query or the right-hand query, but not
both.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">customers</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&#39;KS&#39;</span><span class="p">)</span>
<span class="n">stores</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">&#39;KS&#39;</span><span class="p">)</span>

<span class="c"># Get all cities in kanasas where we have either customers with no</span>
<span class="c"># store, or a store with no customers.</span>
<span class="n">cities</span> <span class="o">=</span> <span class="p">(</span><span class="n">customers</span> <span class="o">^</span> <span class="n">stores</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">SQL</span><span class="p">(</span><span class="s">&#39;city&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="UpdateQuery">
<em class="property">class </em><code class="descname">UpdateQuery</code><span class="sig-paren">(</span><em>model_class</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#UpdateQuery" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>model</strong> &#8211; <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> class on which to perform update</li>
<li><strong>kwargs</strong> &#8211; mapping of field/value pairs containing columns and values to update</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Example in which users are marked inactive if their registration expired:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">uq</span> <span class="o">=</span> <span class="n">UpdateQuery</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">registration_expired</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">uq</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c"># Perform the actual update</span>
</pre></div>
</div>
<p>Example of an atomic update:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">atomic_update</span> <span class="o">=</span> <span class="n">UpdateQuery</span><span class="p">(</span><span class="n">PageCount</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">PageCount</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">PageCount</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="n">url</span><span class="p">)</span>
<span class="n">atomic_update</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c"># will perform the actual update</span>
</pre></div>
</div>
<dl class="method">
<dt id="UpdateQuery.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#UpdateQuery.execute" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">Number of rows updated</td>
</tr>
</tbody>
</table>
<p>Performs the query</p>
</dd></dl>

<dl class="method">
<dt id="UpdateQuery.on_conflict">
<code class="descname">on_conflict</code><span class="sig-paren">(</span><span class="optional">[</span><em>action=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#UpdateQuery.on_conflict" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a SQL <code class="docutils literal"><span class="pre">ON</span> <span class="pre">CONFLICT</span></code> clause with the specified action to the given <code class="docutils literal"><span class="pre">UPDATE</span></code> query. <a class="reference external" href="https://www.sqlite.org/lang_conflict.html">Valid actions</a> are:</p>
<ul class="simple">
<li>ROLLBACK</li>
<li>ABORT</li>
<li>FAIL</li>
<li>IGNORE</li>
<li>REPLACE</li>
</ul>
<p>Specifying <code class="docutils literal"><span class="pre">None</span></code> for the action will execute a normal <code class="docutils literal"><span class="pre">UPDATE</span></code> query.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This feature is only available on SQLite databases.</p>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="InsertQuery">
<em class="property">class </em><code class="descname">InsertQuery</code><span class="sig-paren">(</span><em>model_class</em><span class="optional">[</span>, <em>field_dict=None</em><span class="optional">[</span>, <em>rows=None</em><span class="optional">[</span>, <em>fields=None</em><span class="optional">[</span>, <em>query=None</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#InsertQuery" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an <code class="docutils literal"><span class="pre">InsertQuery</span></code> instance for the given model.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>field_dict</strong> (<em>dict</em>) &#8211; A mapping of either field or field-name to value.</li>
<li><strong>rows</strong> (<em>iterable</em>) &#8211; An iterable of dictionaries containing a mapping of
field or field-name to value.</li>
<li><strong>fields</strong> (<em>list</em>) &#8211; A list of field objects to insert data into (only used in combination with the <code class="docutils literal"><span class="pre">query</span></code> parameter).</li>
<li><strong>query</strong> &#8211; A <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> to use as the source of data.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Basic example:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;admin&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;test&#39;</span><span class="p">,</span> <span class="s">&#39;active&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iq</span> <span class="o">=</span> <span class="n">InsertQuery</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iq</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c"># insert new row and return primary key</span>
<span class="go">2L</span>
</pre></div>
</div>
<p>Example inserting multiple rows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">users</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;charlie&#39;</span><span class="p">,</span> <span class="s">&#39;active&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
    <span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;peewee&#39;</span><span class="p">,</span> <span class="s">&#39;active&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">},</span>
    <span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;huey&#39;</span><span class="p">,</span> <span class="s">&#39;active&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}]</span>
<span class="n">iq</span> <span class="o">=</span> <span class="n">InsertQuery</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">users</span><span class="p">)</span>
<span class="n">iq</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
<p>Example inserting using a query as the data source:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">COUNT</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">JOIN</span><span class="o">.</span><span class="n">LEFT_OUTER</span><span class="p">)</span>
         <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
<span class="n">iq</span> <span class="o">=</span> <span class="n">InsertQuery</span><span class="p">(</span>
    <span class="n">UserTweetDenorm</span><span class="p">,</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">UserTweetDenorm</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">UserTweetDenorm</span><span class="o">.</span><span class="n">num_tweets</span><span class="p">],</span>
    <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
<span class="n">iq</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="InsertQuery.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#InsertQuery.execute" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">primary key of the new row</td>
</tr>
</tbody>
</table>
<p>Performs the query</p>
</dd></dl>

<dl class="method">
<dt id="InsertQuery.upsert">
<code class="descname">upsert</code><span class="sig-paren">(</span><span class="optional">[</span><em>upsert=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#InsertQuery.upsert" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform an <em>INSERT OR REPLACE</em> query.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This feature is only available on SQLite databases.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="InsertQuery.on_conflict">
<code class="descname">on_conflict</code><span class="sig-paren">(</span><span class="optional">[</span><em>action=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#InsertQuery.on_conflict" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a SQL <code class="docutils literal"><span class="pre">ON</span> <span class="pre">CONFLICT</span></code> clause with the specified action to the given <code class="docutils literal"><span class="pre">INSERT</span></code> query. Specifying <code class="docutils literal"><span class="pre">REPLACE</span></code> is equivalent to using the <a class="reference internal" href="#InsertQuery.upsert" title="InsertQuery.upsert"><code class="xref py py-meth docutils literal"><span class="pre">upsert()</span></code></a> method. <a class="reference external" href="https://www.sqlite.org/lang_conflict.html">Valid actions</a> are:</p>
<ul class="simple">
<li>ROLLBACK</li>
<li>ABORT</li>
<li>FAIL</li>
<li>IGNORE</li>
<li>REPLACE</li>
</ul>
<p>Specifying <code class="docutils literal"><span class="pre">None</span></code> for the action will execute a normal <code class="docutils literal"><span class="pre">INSERT</span></code> query.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This feature is only available on SQLite databases.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="InsertQuery.return_id_list">
<code class="descname">return_id_list</code><span class="sig-paren">(</span><span class="optional">[</span><em>return_id_list=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#InsertQuery.return_id_list" title="Permalink to this definition">¶</a></dt>
<dd><p>By default, when doing bulk INSERTs, peewee will not return the list of generated primary keys. However, if the database supports returning primary keys via <code class="docutils literal"><span class="pre">INSERT</span> <span class="pre">...</span> <span class="pre">RETURNING</span></code>, this method instructs peewee to return the generated list of IDs.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently only PostgreSQL supports this behavior. While other databases support bulk inserts, they will simply return <code class="docutils literal"><span class="pre">True</span></code> instead.</p>
</div>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">usernames</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">username</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;charlie&#39;</span><span class="p">,</span> <span class="s">&#39;huey&#39;</span><span class="p">,</span> <span class="s">&#39;mickey&#39;</span><span class="p">]]</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">usernames</span><span class="p">)</span><span class="o">.</span><span class="n">return_id_list</span><span class="p">()</span>
<span class="n">user_ids</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="k">print</span> <span class="n">user_ids</span>
<span class="c"># prints something like [1, 2, 3]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="DeleteQuery">
<em class="property">class </em><code class="descname">DeleteQuery</code><span class="sig-paren">(</span><em>model_class</em><span class="sig-paren">)</span><a class="headerlink" href="#DeleteQuery" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a <em>DELETE</em> query for the given model.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">DeleteQuery will <em>not</em> traverse foreign keys or ensure that constraints
are obeyed, so use it with care.</p>
</div>
<p>Example deleting users whose account is inactive:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">dq</span> <span class="o">=</span> <span class="n">DeleteQuery</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="DeleteQuery.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#DeleteQuery.execute" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">Number of rows deleted</td>
</tr>
</tbody>
</table>
<p>Performs the query</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="RawQuery">
<em class="property">class </em><code class="descname">RawQuery</code><span class="sig-paren">(</span><em>model_class</em>, <em>sql</em>, <em>*params</em><span class="sig-paren">)</span><a class="headerlink" href="#RawQuery" title="Permalink to this definition">¶</a></dt>
<dd><p>Allows execution of an arbitrary query and returns instances
of the model via a <code class="xref py py-class docutils literal"><span class="pre">QueryResultsWrapper</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Generally you will only need this for executing highly optimized SELECT
queries.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you are executing a parameterized query, you must use the correct
interpolation string for your database.  SQLite uses <code class="docutils literal"><span class="pre">'?'</span></code> and most others
use <code class="docutils literal"><span class="pre">'%s'</span></code>.</p>
</div>
<p>Example selecting users with a given username:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">rq</span> <span class="o">=</span> <span class="n">RawQuery</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="s">&#39;SELECT * FROM users WHERE username = ?&#39;</span><span class="p">,</span> <span class="s">&#39;admin&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">rq</span><span class="o">.</span><span class="n">execute</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">obj</span>
<span class="go">&lt;User: admin&gt;</span>
</pre></div>
</div>
<dl class="method">
<dt id="RawQuery.tuples">
<code class="descname">tuples</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#RawQuery.tuples" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#RawQuery" title="RawQuery"><code class="xref py py-class docutils literal"><span class="pre">RawQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Flag this query indicating it should simply return raw tuples from the cursor.
This method is useful when you either do not want or do not need full model
instances.</p>
</dd></dl>

<dl class="method">
<dt id="RawQuery.dicts">
<code class="descname">dicts</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#RawQuery.dicts" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference internal" href="#RawQuery" title="RawQuery"><code class="xref py py-class docutils literal"><span class="pre">RawQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Flag this query indicating it should simply return raw dicts from the cursor.
This method is useful when you either do not want or do not need full model
instances.</p>
</dd></dl>

<dl class="method">
<dt id="RawQuery.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#RawQuery.execute" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">a <code class="xref py py-class docutils literal"><span class="pre">QueryResultWrapper</span></code> for iterating over the result set.  The results are instances of the given model.</td>
</tr>
</tbody>
</table>
<p>Performs the query</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="CompoundSelect">
<em class="property">class </em><code class="descname">CompoundSelect</code><span class="sig-paren">(</span><em>model_class</em>, <em>lhs</em>, <em>operator</em>, <em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#CompoundSelect" title="Permalink to this definition">¶</a></dt>
<dd><p>Compound select query.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>model_class</strong> &#8211; The type of model to return, by default the model class
of the <code class="docutils literal"><span class="pre">lhs</span></code> query.</li>
<li><strong>lhs</strong> &#8211; Left-hand query, either a <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> or a <code class="xref py py-class docutils literal"><span class="pre">CompoundQuery</span></code>.</li>
<li><strong>operator</strong> &#8211; A <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a> instance used to join the two queries, for example <code class="docutils literal"><span class="pre">SQL('UNION')</span></code>.</li>
<li><strong>rhs</strong> &#8211; Right query, either a <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> or a <code class="xref py py-class docutils literal"><span class="pre">CompoundQuery</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="prefetch">
<code class="descname">prefetch</code><span class="sig-paren">(</span><em>sq</em>, <em>*subqueries</em><span class="sig-paren">)</span><a class="headerlink" href="#prefetch" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sq</strong> &#8211; <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> instance</li>
<li><strong>subqueries</strong> &#8211; one or more <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> instances to prefetch for <code class="docutils literal"><span class="pre">sq</span></code>. You
can also pass models, but they will be converted into SelectQueries.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> with related instances pre-populated</p>
</td>
</tr>
</tbody>
</table>
<p>Pre-fetch the appropriate instances from the subqueries and apply them to
their corresponding parent row in the outer query. This function will eagerly
load the related instances specified in the subqueries. This is a technique used
to save doing O(n) queries for n rows, and rather is O(k) queries for <em>k</em>
subqueries.</p>
<p>For example, consider you have a list of users and want to display all their
tweets:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># let&#39;s impost some small restrictions on our queries</span>
<span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">tweets</span> <span class="o">=</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">published</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>

<span class="c"># this will perform 2 queries</span>
<span class="n">users_pf</span> <span class="o">=</span> <span class="n">prefetch</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">tweets</span><span class="p">)</span>

<span class="c"># now we can:</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users_pf</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span>
    <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">tweets_prefetch</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;- &#39;</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">content</span>
</pre></div>
</div>
<p>You can prefetch an arbitrary number of items.  For instance, suppose we have
a photo site, User -&gt; Photo -&gt; (Comments, Tags).  That is, users can post photos,
and these photos can have tags and comments on them.  If we wanted to fetch a
list of users, all their photos, and all the comments and tags on the photos:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
<span class="n">published_photos</span> <span class="o">=</span> <span class="n">Photo</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Photo</span><span class="o">.</span><span class="n">published</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">published_comments</span> <span class="o">=</span> <span class="n">Comment</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">Comment</span><span class="o">.</span><span class="n">is_spam</span> <span class="o">==</span> <span class="bp">False</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">Comment</span><span class="o">.</span><span class="n">num_flags</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">))</span>

<span class="c"># note that we are just passing the Tag model -- it will be converted</span>
<span class="c"># to a query automatically</span>
<span class="n">users_pf</span> <span class="o">=</span> <span class="n">prefetch</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">published_photos</span><span class="p">,</span> <span class="n">published_comments</span><span class="p">,</span> <span class="n">Tag</span><span class="p">)</span>

<span class="c"># now we can iterate users, photos, and comments/tags</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users_pf</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">photo</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">photo_set_prefetch</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">photo</span><span class="o">.</span><span class="n">comment_set_prefetch</span><span class="p">:</span>
            <span class="c"># ...</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">photo</span><span class="o">.</span><span class="n">tag_set_prefetch</span><span class="p">:</span>
            <span class="c"># ...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Subqueries must be related by foreign key and can be arbitrarily deep</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For more information, see the <a class="reference internal" href="querying.html#nplusone"><span>Avoiding N+1 queries</span></a> document and the <a class="reference internal" href="querying.html#prefetch"><span>Using prefetch</span></a> sub-section.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><a class="reference internal" href="#prefetch" title="prefetch"><code class="xref py py-func docutils literal"><span class="pre">prefetch()</span></code></a> can use up lots of RAM when the result set is large,
and will not warn you if you are doing something dangerous, so it is up
to you to know when to use it.  Additionally, because of the semantics of
subquerying, there may be some cases when prefetch does not act as you
expect (for instance, when applying a <code class="docutils literal"><span class="pre">LIMIT</span></code> to subqueries, but there
may be others) &#8211; please report anything you think is a bug to <a class="reference external" href="https://github.com/coleifer/peewee/issues">github</a>.</p>
</div>
</dd></dl>

</div>
<div class="section" id="database-and-its-subclasses">
<h2>Database and its subclasses<a class="headerlink" href="#database-and-its-subclasses" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="Database">
<em class="property">class </em><code class="descname">Database</code><span class="sig-paren">(</span><em>database</em><span class="optional">[</span>, <em>threadlocals=True</em><span class="optional">[</span>, <em>autocommit=True</em><span class="optional">[</span>, <em>fields=None</em><span class="optional">[</span>, <em>ops=None</em><span class="optional">[</span>, <em>autorollback=False</em><span class="optional">[</span>, <em>**connect_kwargs</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>database</strong> &#8211; the name of the database (or filename if using sqlite)</li>
<li><strong>threadlocals</strong> (<em>bool</em>) &#8211; whether to store connections in a threadlocal</li>
<li><strong>autocommit</strong> (<em>bool</em>) &#8211; automatically commit every query executed by calling <code class="xref py py-meth docutils literal"><span class="pre">execute()</span></code></li>
<li><strong>fields</strong> (<em>dict</em>) &#8211; a mapping of <code class="xref py py-attr docutils literal"><span class="pre">db_field</span></code> to database column type, e.g. &#8216;string&#8217; =&gt; &#8216;varchar&#8217;</li>
<li><strong>ops</strong> (<em>dict</em>) &#8211; a mapping of operations understood by the querycompiler to expressions</li>
<li><strong>autorollback</strong> (<em>bool</em>) &#8211; automatically rollback when an exception occurs while executing a query.</li>
<li><strong>connect_kwargs</strong> &#8211; any arbitrary parameters to pass to the database driver when connecting</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal"><span class="pre">connect_kwargs</span></code> dictionary is used for vendor-specific parameters that will be passed back directly to your database driver, allowing you to specify the <code class="docutils literal"><span class="pre">user</span></code>, <code class="docutils literal"><span class="pre">host</span></code> and <code class="docutils literal"><span class="pre">password</span></code>, for instance. For more information and examples, see the <a class="reference internal" href="database.html#vendor-specific-parameters"><span>vendor-specific parameters document</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If your database name is not known when the class is declared, you can pass
<code class="docutils literal"><span class="pre">None</span></code> in as the database name which will mark the database as &#8220;deferred&#8221;
and any attempt to connect while in this state will raise an exception.  To
initialize your database, call the <a class="reference internal" href="#Database.init" title="Database.init"><code class="xref py py-meth docutils literal"><span class="pre">Database.init()</span></code></a> method with
the database name.</p>
<p class="last">For an in-depth discussion of run-time database configuration, see the <a class="reference internal" href="database.html#deferring-initialization"><span>Run-time database configuration</span></a> section.</p>
</div>
<p>A high-level API for working with the supported database engines. The database class:</p>
<ul class="simple">
<li>Manages the underlying database connection.</li>
<li>Executes queries.</li>
<li>Manage transactions and savepoints.</li>
<li>Create and drop tables and indexes.</li>
<li>Introspect the database.</li>
</ul>
<dl class="attribute">
<dt>
<code class="descname">commit_select = False</code></dt>
<dd><p>Whether to issue a commit after executing a select query.  With some engines
can prevent implicit transactions from piling up.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">compiler_class = QueryCompiler</code></dt>
<dd><p>A class suitable for compiling queries</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">compound_operations = ['UNION', 'INTERSECT', 'EXCEPT']</code></dt>
<dd><p>Supported compound query operations.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">compound_select_parentheses = False</code></dt>
<dd><p>Whether <code class="docutils literal"><span class="pre">UNION</span></code> (or other compound <code class="docutils literal"><span class="pre">SELECT</span></code> queries) allow parentheses around the queries.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">distinct_on = False</code></dt>
<dd><p>Whether the database supports <code class="docutils literal"><span class="pre">DISTINCT</span> <span class="pre">ON</span></code> statements.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">drop_cascade = False</code></dt>
<dd><p>Whether the database supports cascading drop table queries.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">field_overrides = {}</code></dt>
<dd><p>A mapping of field types to database column types, e.g. <code class="docutils literal"><span class="pre">{'primary_key':</span> <span class="pre">'SERIAL'}</span></code></p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">foreign_keys = True</code></dt>
<dd><p>Whether the given backend enforces foreign key constraints.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">for_update = False</code></dt>
<dd><p>Whether the given backend supports selecting rows for update</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">for_update_nowait = False</code></dt>
<dd><p>Whether the given backend supports selecting rows for update</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">insert_many = True</code></dt>
<dd><p>Whether the database supports multiple <code class="docutils literal"><span class="pre">VALUES</span></code> clauses for <code class="docutils literal"><span class="pre">INSERT</span></code> queries.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">insert_returning = False</code></dt>
<dd><p>Whether the database supports returning the primary key for newly inserted rows.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">interpolation = '?'</code></dt>
<dd><p>The string used by the driver to interpolate query parameters</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">op_overrides = {}</code></dt>
<dd><p>A mapping of operation codes to string operations, e.g. <code class="docutils literal"><span class="pre">{OP.LIKE:</span> <span class="pre">'LIKE</span> <span class="pre">BINARY'}</span></code></p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">quote_char = '&quot;'</code></dt>
<dd><p>The string used by the driver to quote names</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">reserved_tables = []</code></dt>
<dd><p>Table names that are reserved by the backend &#8211; if encountered in the
application a warning will be issued.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">savepoints = True</code></dt>
<dd><p>Whether the given backend supports savepoints.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">sequences = False</code></dt>
<dd><p>Whether the given backend supports sequences</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">subquery_delete_same_table = True</code></dt>
<dd><p>Whether the given backend supports deleting rows using a subquery
that selects from the same table</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">window_functions = False</code></dt>
<dd><p>Whether the given backend supports window functions.</p>
</dd></dl>

<dl class="method">
<dt id="Database.init">
<code class="descname">init</code><span class="sig-paren">(</span><em>database</em><span class="optional">[</span>, <em>**connect_kwargs</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.init" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is used to initialize a deferred database. For details on configuring your database at run-time, see the <a class="reference internal" href="database.html#deferring-initialization"><span>Run-time database configuration</span></a> section.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>database</strong> &#8211; the name of the database (or filename if using sqlite)</li>
<li><strong>connect_kwargs</strong> &#8211; any arbitrary parameters to pass to the database driver when connecting</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.connect">
<code class="descname">connect</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Establishes a connection to the database</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, connections will be stored on a threadlocal, ensuring connections are not shared across threads. To disable this behavior, initialize the database with <code class="docutils literal"><span class="pre">threadlocals=False</span></code>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Closes the connection to the database (if one is open)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you initialized with <code class="docutils literal"><span class="pre">threadlocals=True</span></code>, only a connection local
to the calling thread will be closed.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.initialize_connection">
<code class="descname">initialize_connection</code><span class="sig-paren">(</span><em>conn</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.initialize_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform additional intialization on a newly-opened connection. For example, if you are using SQLite you may want to enable foreign key constraint enforcement (off by default).</p>
<p>Here is how you might use this hook to enable foreign key enforcement on SQLite:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SqliteFKDatabase</span><span class="p">(</span><span class="n">SqliteDatabase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute_sql</span><span class="p">(</span><span class="s">&#39;PRAGMA foreign_keys=ON;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.get_conn">
<code class="descname">get_conn</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_conn" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">a connection to the database, creates one if does not exist</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.get_cursor">
<code class="descname">get_cursor</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_cursor" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">a cursor for executing queries</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.last_insert_id">
<code class="descname">last_insert_id</code><span class="sig-paren">(</span><em>cursor</em>, <em>model</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.last_insert_id" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>cursor</strong> &#8211; the database cursor used to perform the insert query</li>
<li><strong>model</strong> &#8211; the model class that was just created</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">the primary key of the most recently inserted instance</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.rows_affected">
<code class="descname">rows_affected</code><span class="sig-paren">(</span><em>cursor</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.rows_affected" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">number of rows affected by the last query</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.compiler">
<code class="descname">compiler</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.compiler" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">an instance of <code class="xref py py-class docutils literal"><span class="pre">QueryCompiler</span></code> using the field and
op overrides specified.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.execute_sql">
<code class="descname">execute_sql</code><span class="sig-paren">(</span><em>sql</em><span class="optional">[</span>, <em>params=None</em><span class="optional">[</span>, <em>require_commit=True</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.execute_sql" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>sql</strong> &#8211; a string sql query</li>
<li><strong>params</strong> &#8211; a list or tuple of parameters to interpolate</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can configure whether queries will automatically commit by using
the <a class="reference internal" href="#Database.set_autocommit" title="Database.set_autocommit"><code class="xref py py-meth docutils literal"><span class="pre">set_autocommit()</span></code></a> and <a class="reference internal" href="#Database.get_autocommit" title="Database.get_autocommit"><code class="xref py py-meth docutils literal"><span class="pre">Database.get_autocommit()</span></code></a>
methods.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.begin">
<code class="descname">begin</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.begin" title="Permalink to this definition">¶</a></dt>
<dd><p>Initiate a new transaction.  By default <strong>not</strong> implemented as this is not
part of the DB-API 2.0, but provided for API compatibility.</p>
</dd></dl>

<dl class="method">
<dt id="Database.commit">
<code class="descname">commit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.commit" title="Permalink to this definition">¶</a></dt>
<dd><p>Call <code class="docutils literal"><span class="pre">commit()</span></code> on the active connection, committing the current transaction.</p>
</dd></dl>

<dl class="method">
<dt id="Database.rollback">
<code class="descname">rollback</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.rollback" title="Permalink to this definition">¶</a></dt>
<dd><p>Call <code class="docutils literal"><span class="pre">rollback()</span></code> on the active connection, rolling back the current transaction.</p>
</dd></dl>

<dl class="method">
<dt id="Database.set_autocommit">
<code class="descname">set_autocommit</code><span class="sig-paren">(</span><em>autocommit</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.set_autocommit" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>autocommit</strong> &#8211; a boolean value indicating whether to turn on/off autocommit.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.get_autocommit">
<code class="descname">get_autocommit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_autocommit" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">a boolean value indicating whether autocommit is enabled.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.get_tables">
<code class="descname">get_tables</code><span class="sig-paren">(</span><span class="optional">[</span><em>schema=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_tables" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">a list of table names in the database.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.get_indexes">
<code class="descname">get_indexes</code><span class="sig-paren">(</span><em>table</em><span class="optional">[</span>, <em>schema=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_indexes" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">a list of <a class="reference internal" href="#IndexMetadata" title="IndexMetadata"><code class="xref py py-class docutils literal"><span class="pre">IndexMetadata</span></code></a> instances, representing the indexes for the given table.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.get_columns">
<code class="descname">get_columns</code><span class="sig-paren">(</span><em>table</em><span class="optional">[</span>, <em>schema=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_columns" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">a list of <a class="reference internal" href="#ColumnMetadata" title="ColumnMetadata"><code class="xref py py-class docutils literal"><span class="pre">ColumnMetadata</span></code></a> instances, representing the columns for the given table.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.get_primary_keys">
<code class="descname">get_primary_keys</code><span class="sig-paren">(</span><em>table</em><span class="optional">[</span>, <em>schema=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_primary_keys" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">a list containing the primary key column name(s) for the given table.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.get_foreign_keys">
<code class="descname">get_foreign_keys</code><span class="sig-paren">(</span><em>table</em><span class="optional">[</span>, <em>schema=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_foreign_keys" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">a list of <a class="reference internal" href="#ForeignKeyMetadata" title="ForeignKeyMetadata"><code class="xref py py-class docutils literal"><span class="pre">ForeignKeyMetadata</span></code></a> instances, representing the foreign keys for the given table.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.sequence_exists">
<code class="descname">sequence_exists</code><span class="sig-paren">(</span><em>sequence_name</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.sequence_exists" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Rtype boolean:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.create_table">
<code class="descname">create_table</code><span class="sig-paren">(</span><em>model_class</em><span class="optional">[</span>, <em>safe=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.create_table" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>model_class</strong> &#8211; <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> class.</li>
<li><strong>safe</strong> (<em>bool</em>) &#8211; If <cite>True</cite>, the table will not be created if it already exists.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Unlike <a class="reference internal" href="#Model.create_table" title="Model.create_table"><code class="xref py py-meth docutils literal"><span class="pre">Model.create_table()</span></code></a>, this method does not create indexes or constraints. This method will only create the table itself. If you wish to create the table along with any indexes and constraints, use either <a class="reference internal" href="#Model.create_table" title="Model.create_table"><code class="xref py py-meth docutils literal"><span class="pre">Model.create_table()</span></code></a> or <a class="reference internal" href="#Database.create_tables" title="Database.create_tables"><code class="xref py py-meth docutils literal"><span class="pre">Database.create_tables()</span></code></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.create_index">
<code class="descname">create_index</code><span class="sig-paren">(</span><em>model_class</em>, <em>fields</em><span class="optional">[</span>, <em>unique=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.create_index" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>model_class</strong> &#8211; <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> table on which to create index</li>
<li><strong>fields</strong> &#8211; field(s) to create index on (either field instances or field names)</li>
<li><strong>unique</strong> &#8211; whether the index should enforce uniqueness</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.create_foreign_key">
<code class="descname">create_foreign_key</code><span class="sig-paren">(</span><em>model_class</em>, <em>field</em><span class="optional">[</span>, <em>constraint=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.create_foreign_key" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>model_class</strong> &#8211; <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> table on which to create foreign key constraint</li>
<li><strong>field</strong> &#8211; <code class="xref py py-class docutils literal"><span class="pre">Field</span></code> object</li>
<li><strong>constraint</strong> (<em>str</em>) &#8211; Name to give foreign key constraint.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Manually create a foreign key constraint using an <code class="docutils literal"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code> query.
This is primarily used when creating a circular foreign key dependency,
for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">PostProxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">favorite_post</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">PostProxy</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;posts&#39;</span><span class="p">)</span>

<span class="n">PostProxy</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">Post</span><span class="p">)</span>

<span class="c"># Create tables.  The foreign key from Post -&gt; User will be created</span>
<span class="c"># automatically, but the foreign key from User -&gt; Post must be added</span>
<span class="c"># manually.</span>
<span class="n">User</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>
<span class="n">Post</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>

<span class="c"># Manually add the foreign key constraint on `User`, since we could</span>
<span class="c"># not add it until we had created the `Post` table.</span>
<span class="n">db</span><span class="o">.</span><span class="n">create_foreign_key</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">favorite_post</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.create_sequence">
<code class="descname">create_sequence</code><span class="sig-paren">(</span><em>sequence_name</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.create_sequence" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>sequence_name</strong> &#8211; name of sequence to create</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">only works with database engines that support sequences</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.drop_table">
<code class="descname">drop_table</code><span class="sig-paren">(</span><em>model_class</em><span class="optional">[</span>, <em>fail_silently=False</em><span class="optional">[</span>, <em>cascade=False</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.drop_table" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>model_class</strong> &#8211; <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> table to drop</li>
<li><strong>fail_silently</strong> (<em>bool</em>) &#8211; if <code class="docutils literal"><span class="pre">True</span></code>, query will add a <code class="docutils literal"><span class="pre">IF</span> <span class="pre">EXISTS</span></code> clause</li>
<li><strong>cascade</strong> (<em>bool</em>) &#8211; drop table with <code class="docutils literal"><span class="pre">CASCADE</span></code> option.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.drop_sequence">
<code class="descname">drop_sequence</code><span class="sig-paren">(</span><em>sequence_name</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.drop_sequence" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>sequence_name</strong> &#8211; name of sequence to drop</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">only works with database engines that support sequences</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.create_tables">
<code class="descname">create_tables</code><span class="sig-paren">(</span><em>models</em><span class="optional">[</span>, <em>safe=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.create_tables" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>models</strong> (<em>list</em>) &#8211; A list of models.</li>
<li><strong>safe</strong> (<em>bool</em>) &#8211; Check first whether the table exists before attempting to create it.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method should be used for creating tables as it will resolve the model dependency graph and ensure the tables are created in the correct order. This method will also create any indexes and constraints defined on the models.</p>
<p>Usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">db</span><span class="o">.</span><span class="n">create_tables</span><span class="p">([</span><span class="n">User</span><span class="p">,</span> <span class="n">Tweet</span><span class="p">,</span> <span class="n">Something</span><span class="p">],</span> <span class="n">safe</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.drop_tables">
<code class="descname">drop_tables</code><span class="sig-paren">(</span><em>models</em><span class="optional">[</span>, <em>safe=False</em><span class="optional">[</span>, <em>cascade=False</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.drop_tables" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>models</strong> (<em>list</em>) &#8211; A list of models.</li>
<li><strong>safe</strong> (<em>bool</em>) &#8211; Check the table exists before attempting to drop it.</li>
<li><strong>cascade</strong> (<em>bool</em>) &#8211; drop table with <code class="docutils literal"><span class="pre">CASCADE</span></code> option.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method should be used for dropping tables, as it will resolve the model dependency graph and ensure the tables are dropped in the correct order.</p>
<p>Usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">db</span><span class="o">.</span><span class="n">drop_tables</span><span class="p">([</span><span class="n">User</span><span class="p">,</span> <span class="n">Tweet</span><span class="p">,</span> <span class="n">Something</span><span class="p">],</span> <span class="n">safe</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.atomic">
<code class="descname">atomic</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.atomic" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute statements in either a transaction or a savepoint. The outer-most call to <em>atomic</em> will use a transaction,
and any subsequent nested calls will use savepoints.</p>
<p><code class="docutils literal"><span class="pre">atomic</span></code> can be used as either a context manager or a decorator.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For most use-cases, it makes the most sense to always use <a class="reference internal" href="#Database.atomic" title="Database.atomic"><code class="xref py py-meth docutils literal"><span class="pre">atomic()</span></code></a> when you wish to execute queries in a transaction. The benefit of using <code class="docutils literal"><span class="pre">atomic</span></code> is that you do not need to manually keep track of the transaction stack depth, as this will be managed for you.</p>
</div>
<p>Context manager example code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">atomic</span><span class="p">()</span> <span class="k">as</span> <span class="n">txn</span><span class="p">:</span>
    <span class="n">perform_some_operations</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">atomic</span><span class="p">()</span> <span class="k">as</span> <span class="n">nested_txn</span><span class="p">:</span>
        <span class="n">do_other_things</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">something_bad_happened</span><span class="p">():</span>
            <span class="c"># Roll back these changes, but preserve the changes</span>
            <span class="c"># made in the outer block.</span>
            <span class="n">nested_txn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</pre></div>
</div>
<p>Decorator example code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@db.atomic</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="c"># This function will execute in a transaction/savepoint.</span>
    <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.transaction">
<code class="descname">transaction</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.transaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute statements in a transaction using either a context manager or decorator. If an
error is raised inside the wrapped block, the transaction will be rolled
back, otherwise statements are committed when exiting. Transactions can also be explicitly rolled back or committed within the transaction block by calling <a class="reference internal" href="#transaction.rollback" title="transaction.rollback"><code class="xref py py-meth docutils literal"><span class="pre">rollback()</span></code></a> or <a class="reference internal" href="#transaction.commit" title="transaction.commit"><code class="xref py py-meth docutils literal"><span class="pre">commit()</span></code></a>. If you manually commit or roll back, a new transaction will be started automatically.</p>
<p>Nested blocks can be wrapped with <code class="docutils literal"><span class="pre">transaction</span></code> - the database
will keep a stack and only commit when it reaches the end of the outermost
function / block.</p>
<p>Context manager example code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># delete a blog instance and all its associated entries, but</span>
<span class="c"># do so within a transaction</span>
<span class="k">with</span> <span class="n">database</span><span class="o">.</span><span class="n">transaction</span><span class="p">():</span>
    <span class="n">blog</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="c"># Explicitly roll back a transaction.</span>
<span class="k">with</span> <span class="n">database</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">txn</span><span class="p">:</span>
    <span class="n">do_some_stuff</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">something_bad_happened</span><span class="p">():</span>
        <span class="c"># Roll back any changes made within this block.</span>
        <span class="n">txn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</pre></div>
</div>
<p>Decorator example code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@database.transaction</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">transfer_money</span><span class="p">(</span><span class="n">from_acct</span><span class="p">,</span> <span class="n">to_acct</span><span class="p">,</span> <span class="n">amt</span><span class="p">):</span>
    <span class="n">from_acct</span><span class="o">.</span><span class="n">charge</span><span class="p">(</span><span class="n">amt</span><span class="p">)</span>
    <span class="n">to_acct</span><span class="o">.</span><span class="n">pay</span><span class="p">(</span><span class="n">amt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">amt</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.commit_on_success">
<code class="descname">commit_on_success</code><span class="sig-paren">(</span><em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.commit_on_success" title="Permalink to this definition">¶</a></dt>
<dd><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use <a class="reference internal" href="#Database.atomic" title="Database.atomic"><code class="xref py py-meth docutils literal"><span class="pre">atomic()</span></code></a> or <a class="reference internal" href="#Database.transaction" title="Database.transaction"><code class="xref py py-meth docutils literal"><span class="pre">transaction()</span></code></a> instead.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.savepoint">
<code class="descname">savepoint</code><span class="sig-paren">(</span><span class="optional">[</span><em>sid=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.savepoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute statements in a savepoint using either a context manager or decorator.  If an
error is raised inside the wrapped block, the savepoint will be rolled
back, otherwise statements are committed when exiting. Like <a class="reference internal" href="#Database.transaction" title="Database.transaction"><code class="xref py py-meth docutils literal"><span class="pre">transaction()</span></code></a>, a savepoint can also be explicitly rolled-back or committed by calling <a class="reference internal" href="#savepoint.rollback" title="savepoint.rollback"><code class="xref py py-meth docutils literal"><span class="pre">rollback()</span></code></a> or <a class="reference internal" href="#savepoint.commit" title="savepoint.commit"><code class="xref py py-meth docutils literal"><span class="pre">commit()</span></code></a>. If you manually commit or roll back, a new savepoint <strong>will not</strong> be created.</p>
<p>Savepoints can be thought of as nested transactions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>sid</strong> (<em>str</em>) &#8211; An optional string identifier for the savepoint.</td>
</tr>
</tbody>
</table>
<p>Context manager example code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">txn</span><span class="p">:</span>
    <span class="n">do_some_stuff</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">savepoint</span><span class="p">()</span> <span class="k">as</span> <span class="n">sp1</span><span class="p">:</span>
        <span class="n">do_more_things</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">savepoint</span><span class="p">()</span> <span class="k">as</span> <span class="n">sp2</span><span class="p">:</span>
        <span class="n">even_more</span><span class="p">()</span>
        <span class="c"># Oops, something bad happened, roll back</span>
        <span class="c"># just the changes made in this block.</span>
        <span class="k">if</span> <span class="n">something_bad_happened</span><span class="p">():</span>
            <span class="n">sp2</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.execution_context">
<code class="descname">execution_context</code><span class="sig-paren">(</span><span class="optional">[</span><em>with_transaction=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.execution_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an <a class="reference internal" href="#ExecutionContext" title="ExecutionContext"><code class="xref py py-class docutils literal"><span class="pre">ExecutionContext</span></code></a> context manager or decorator. Blocks wrapped with an <em>ExecutionContext</em> will run using their own connection. By default, the wrapped block will also run in a transaction, although this can be disabled specifyin <code class="docutils literal"><span class="pre">with_transaction=False</span></code>.</p>
<p>For more explanation of <a class="reference internal" href="#ExecutionContext" title="ExecutionContext"><code class="xref py py-class docutils literal"><span class="pre">ExecutionContext</span></code></a>, see the <a class="reference internal" href="database.html#advanced-connection-management"><span>Advanced Connection Management</span></a> section.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">ExecutionContext is very new and has not been tested extensively.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Database.register_fields">
<em class="property">classmethod </em><code class="descname">register_fields</code><span class="sig-paren">(</span><em>fields</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.register_fields" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a mapping of field overrides for the database class.  Used
to register custom fields or override the defaults.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>fields</strong> (<em>dict</em>) &#8211; A mapping of <code class="xref py py-attr docutils literal"><span class="pre">db_field</span></code> to column type</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="Database.register_ops">
<em class="property">classmethod </em><code class="descname">register_ops</code><span class="sig-paren">(</span><em>ops</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.register_ops" title="Permalink to this definition">¶</a></dt>
<dd><p>Register a mapping of operations understood by the QueryCompiler to their
SQL equivalent, e.g. <code class="docutils literal"><span class="pre">{OP.EQ:</span> <span class="pre">'='}</span></code>.  Used to extend the types of field
comparisons.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>fields</strong> (<em>dict</em>) &#8211; A mapping of <code class="xref py py-attr docutils literal"><span class="pre">db_field</span></code> to column type</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.extract_date">
<code class="descname">extract_date</code><span class="sig-paren">(</span><em>date_part</em>, <em>date_field</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.extract_date" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an expression suitable for extracting a date part from a date
field.  For instance, extract the year from a <a class="reference internal" href="#DateTimeField" title="DateTimeField"><code class="xref py py-class docutils literal"><span class="pre">DateTimeField</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>date_part</strong> (<em>str</em>) &#8211; The date part attribute to retrieve.  Valid options
are: &#8220;year&#8221;, &#8220;month&#8221;, &#8220;day&#8221;, &#8220;hour&#8221;, &#8220;minute&#8221; and &#8220;second&#8221;.</li>
<li><strong>date_field</strong> (<em>Field</em>) &#8211; field instance storing a datetime, date or time.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">an expression object.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.sql_error_handler">
<code class="descname">sql_error_handler</code><span class="sig-paren">(</span><em>exception</em>, <em>sql</em>, <em>params</em>, <em>require_commit</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.sql_error_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>This hook is called when an error is raised executing a query, allowing
your application to inject custom error handling behavior.  The default
implementation simply reraises the exception.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SqliteDatabaseCustom</span><span class="p">(</span><span class="n">SqliteDatabase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">sql_error_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">require_commit</span><span class="p">):</span>
        <span class="c"># Perform some custom behavior, for example close the</span>
        <span class="c"># connection to the database.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># Re-raise the exception.</span>
        <span class="k">raise</span> <span class="n">exception</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="SqliteDatabase">
<em class="property">class </em><code class="descname">SqliteDatabase</code><span class="sig-paren">(</span><em>Database</em><span class="sig-paren">)</span><a class="headerlink" href="#SqliteDatabase" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#Database" title="Database"><code class="xref py py-class docutils literal"><span class="pre">Database</span></code></a> subclass that works with the &#8220;sqlite3&#8221; driver. In addition to the default database parameters, <a class="reference internal" href="#SqliteDatabase" title="SqliteDatabase"><code class="xref py py-class docutils literal"><span class="pre">SqliteDatabase</span></code></a> also accepts a <em>journal_mode</em> parameter which will configure the journaling mode.</p>
<p>To use write-ahead log:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;my_app.db&#39;</span><span class="p">,</span> <span class="n">journal_mode</span><span class="o">=</span><span class="s">&#39;WAL&#39;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="attribute">
<dt>
<code class="descname">insert_many = True *if* using SQLite 3.7.11.0 or newer.</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="MySQLDatabase">
<em class="property">class </em><code class="descname">MySQLDatabase</code><span class="sig-paren">(</span><em>Database</em><span class="sig-paren">)</span><a class="headerlink" href="#MySQLDatabase" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#Database" title="Database"><code class="xref py py-class docutils literal"><span class="pre">Database</span></code></a> subclass that works with either &#8220;MySQLdb&#8221; or &#8220;pymysql&#8221;.</p>
<dl class="attribute">
<dt>
<code class="descname">commit_select = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">compound_operations = ['UNION']</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">for_update = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">subquery_delete_same_table = False</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="PostgresqlDatabase">
<em class="property">class </em><code class="descname">PostgresqlDatabase</code><span class="sig-paren">(</span><em>Database</em><span class="sig-paren">)</span><a class="headerlink" href="#PostgresqlDatabase" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#Database" title="Database"><code class="xref py py-class docutils literal"><span class="pre">Database</span></code></a> subclass that works with the &#8220;psycopg2&#8221; driver</p>
<dl class="attribute">
<dt>
<code class="descname">commit_select = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">compound_select_parentheses = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">distinct_on = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">for_update = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">for_update_nowait = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">insert_returning = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">sequences = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">window_functions = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">register_unicode = True</code></dt>
<dd><p>Control whether the <code class="docutils literal"><span class="pre">UNICODE</span></code> and <code class="docutils literal"><span class="pre">UNICODEARRAY</span></code> psycopg2 extensions are loaded automatically.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="transaction-savepoint-and-executioncontext">
<h2>Transaction, Savepoint and ExecutionContext<a class="headerlink" href="#transaction-savepoint-and-executioncontext" title="Permalink to this headline">¶</a></h2>
<p>The easiest way to create transactions and savepoints is to use <a class="reference internal" href="#Database.atomic" title="Database.atomic"><code class="xref py py-meth docutils literal"><span class="pre">Database.atomic()</span></code></a>. The <a class="reference internal" href="#Database.atomic" title="Database.atomic"><code class="xref py py-meth docutils literal"><span class="pre">atomic()</span></code></a> method will create a transaction or savepoint depending on the level of nesting.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">atomic</span><span class="p">()</span> <span class="k">as</span> <span class="n">txn</span><span class="p">:</span>
    <span class="c"># The outer-most call will be a transaction.</span>
    <span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">atomic</span><span class="p">()</span> <span class="k">as</span> <span class="n">sp</span><span class="p">:</span>
        <span class="c"># Nested calls will be savepoints instead.</span>
        <span class="n">execute_some_statements</span><span class="p">()</span>
</pre></div>
</div>
<dl class="class">
<dt id="transaction">
<em class="property">class </em><code class="descname">transaction</code><span class="sig-paren">(</span><em>database</em><span class="sig-paren">)</span><a class="headerlink" href="#transaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Context manager that encapsulates a database transaction. Statements executed within the wrapped block will be committed at the end of the block unless an exception occurs, in which case any changes will be rolled back.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Transactions should not be nested as this could lead to unpredictable behavior in the event of an exception in a nested block. If you wish to use nested transactions, use the <a class="reference internal" href="#Database.atomic" title="Database.atomic"><code class="xref py py-meth docutils literal"><span class="pre">atomic()</span></code></a> method, which will create a transaction at the outer-most layer and use savepoints for nested blocks.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In practice you should not create <a class="reference internal" href="#transaction" title="transaction"><code class="xref py py-class docutils literal"><span class="pre">transaction</span></code></a> objects directly, but rather use the <a class="reference internal" href="#Database.transaction" title="Database.transaction"><code class="xref py py-meth docutils literal"><span class="pre">Database.transaction()</span></code></a> method.</p>
</div>
<dl class="method">
<dt id="transaction.commit">
<code class="descname">commit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#transaction.commit" title="Permalink to this definition">¶</a></dt>
<dd><p>Manually commit any pending changes and begin a new transaction.</p>
</dd></dl>

<dl class="method">
<dt id="transaction.rollback">
<code class="descname">rollback</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#transaction.rollback" title="Permalink to this definition">¶</a></dt>
<dd><p>Manually roll-back any pending changes and begin a new transaction.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="savepoint">
<em class="property">class </em><code class="descname">savepoint</code><span class="sig-paren">(</span><em>database</em><span class="optional">[</span>, <em>sid=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#savepoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Context manager that encapsulates a savepoint (nested transaction). Statements executed within the wrapped block will be committed at the end of the block unless an exception occurs, in which case any changes will be rolled back.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Savepoints must be created within a transaction. It is recommended that you use <a class="reference internal" href="#Database.atomic" title="Database.atomic"><code class="xref py py-meth docutils literal"><span class="pre">atomic()</span></code></a> instead of manually managing the transaction+savepoint stack.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In practice you should not create <a class="reference internal" href="#savepoint" title="savepoint"><code class="xref py py-class docutils literal"><span class="pre">savepoint</span></code></a> objects directly, but rather use the <a class="reference internal" href="#Database.savepoint" title="Database.savepoint"><code class="xref py py-meth docutils literal"><span class="pre">Database.savepoint()</span></code></a> method.</p>
</div>
<dl class="method">
<dt id="savepoint.commit">
<code class="descname">commit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#savepoint.commit" title="Permalink to this definition">¶</a></dt>
<dd><p>Manually commit any pending changes. If the savepoint is manually committed and additional changes are made, they will be executed in the context of the outer block.</p>
</dd></dl>

<dl class="method">
<dt id="savepoint.rollback">
<code class="descname">rollback</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#savepoint.rollback" title="Permalink to this definition">¶</a></dt>
<dd><p>Manually roll-back any pending changes. If the savepoint is manually rolled-back and additional changes are made, they will be executed in the context of the outer block.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ExecutionContext">
<em class="property">class </em><code class="descname">ExecutionContext</code><span class="sig-paren">(</span><em>database</em><span class="optional">[</span>, <em>with_transaction=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#ExecutionContext" title="Permalink to this definition">¶</a></dt>
<dd><p>ExecutionContext provides a way to explicitly run statements in a dedicated connection. Typically a single database connection is maintained per-thread, but in some situations you may wish to explicitly force a new, separate connection. To accomplish this, you can create an <a class="reference internal" href="#ExecutionContext" title="ExecutionContext"><code class="xref py py-class docutils literal"><span class="pre">ExecutionContext</span></code></a>. Statements executed in the wrapped block will be run in a transaction by default, though you can disable this by specifying <code class="docutils literal"><span class="pre">with_transaction=False</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Rather than instantiating <code class="docutils literal"><span class="pre">ExecutionContext</span></code> directly, use <a class="reference internal" href="#Database.execution_context" title="Database.execution_context"><code class="xref py py-meth docutils literal"><span class="pre">Database.execution_context()</span></code></a>.</p>
</div>
<p>Example code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># This will return the connection associated with the current thread.</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_conn</span><span class="p">()</span>

<span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">execution_context</span><span class="p">():</span>
    <span class="c"># This will be a new connection object. If you are using the</span>
    <span class="c"># connection pool, it may be an unused connection from the pool.</span>
    <span class="n">ctx_conn</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_conn</span><span class="p">()</span>

    <span class="c"># This statement is executed using the new `ctx_conn`.</span>
    <span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;huey&#39;</span><span class="p">)</span>

<span class="c"># At the end of the wrapped block, the connection will be closed and the</span>
<span class="c"># transaction, if one exists, will be committed.</span>

<span class="c"># This statement is executed using the regular `conn`.</span>
<span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;mickey&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="Using">
<em class="property">class </em><code class="descname">Using</code><span class="sig-paren">(</span><em>database</em>, <em>models</em><span class="optional">[</span>, <em>with_transaction=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Using" title="Permalink to this definition">¶</a></dt>
<dd><p>For the duration of the wrapped block, all queries against the given <code class="docutils literal"><span class="pre">models</span></code> will use the specified <code class="docutils literal"><span class="pre">database</span></code>. Optionally these queries can be run inside a transaction by specifying <code class="docutils literal"><span class="pre">with_transaction=True</span></code>.</p>
<p><code class="docutils literal"><span class="pre">Using</span></code> provides, in short, a way to run queries on a list of models using a manually specified database.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>database</strong> &#8211; a <a class="reference internal" href="#Database" title="Database"><code class="xref py py-class docutils literal"><span class="pre">Database</span></code></a> instance.</li>
<li><strong>models</strong> &#8211; a list of <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> classes to use with the given database.</li>
<li><strong>with_transaction</strong> &#8211; Whether the wrapped block should be run in a transaction.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="metadata-types">
<h2>Metadata Types<a class="headerlink" href="#metadata-types" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="IndexMetadata">
<em class="property">class </em><code class="descname">IndexMetadata</code><span class="sig-paren">(</span><em>name</em>, <em>sql</em>, <em>columns</em>, <em>unique</em>, <em>table</em><span class="sig-paren">)</span><a class="headerlink" href="#IndexMetadata" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="IndexMetadata.name">
<code class="descname">name</code><a class="headerlink" href="#IndexMetadata.name" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the index.</p>
</dd></dl>

<dl class="attribute">
<dt id="IndexMetadata.sql">
<code class="descname">sql</code><a class="headerlink" href="#IndexMetadata.sql" title="Permalink to this definition">¶</a></dt>
<dd><p>The SQL query used to generate the index.</p>
</dd></dl>

<dl class="attribute">
<dt id="IndexMetadata.columns">
<code class="descname">columns</code><a class="headerlink" href="#IndexMetadata.columns" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of columns that are covered by the index.</p>
</dd></dl>

<dl class="attribute">
<dt id="IndexMetadata.unique">
<code class="descname">unique</code><a class="headerlink" href="#IndexMetadata.unique" title="Permalink to this definition">¶</a></dt>
<dd><p>A boolean value indicating whether the index has a unique constraint.</p>
</dd></dl>

<dl class="attribute">
<dt id="IndexMetadata.table">
<code class="descname">table</code><a class="headerlink" href="#IndexMetadata.table" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the table containing this index.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ColumnMetadata">
<em class="property">class </em><code class="descname">ColumnMetadata</code><span class="sig-paren">(</span><em>name</em>, <em>data_type</em>, <em>null</em>, <em>primary_key</em>, <em>table</em><span class="sig-paren">)</span><a class="headerlink" href="#ColumnMetadata" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="ColumnMetadata.name">
<code class="descname">name</code><a class="headerlink" href="#ColumnMetadata.name" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the column.</p>
</dd></dl>

<dl class="attribute">
<dt id="ColumnMetadata.data_type">
<code class="descname">data_type</code><a class="headerlink" href="#ColumnMetadata.data_type" title="Permalink to this definition">¶</a></dt>
<dd><p>The data type of the column</p>
</dd></dl>

<dl class="attribute">
<dt id="ColumnMetadata.null">
<code class="descname">null</code><a class="headerlink" href="#ColumnMetadata.null" title="Permalink to this definition">¶</a></dt>
<dd><p>A boolean value indicating whether <code class="docutils literal"><span class="pre">NULL</span></code> is permitted in this column.</p>
</dd></dl>

<dl class="attribute">
<dt id="ColumnMetadata.primary_key">
<code class="descname">primary_key</code><a class="headerlink" href="#ColumnMetadata.primary_key" title="Permalink to this definition">¶</a></dt>
<dd><p>A boolean value indicating whether this column is a primary key.</p>
</dd></dl>

<dl class="attribute">
<dt id="ColumnMetadata.table">
<code class="descname">table</code><a class="headerlink" href="#ColumnMetadata.table" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the table containing this column.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ForeignKeyMetadata">
<em class="property">class </em><code class="descname">ForeignKeyMetadata</code><span class="sig-paren">(</span><em>column</em>, <em>dest_table</em>, <em>dest_column</em>, <em>table</em><span class="sig-paren">)</span><a class="headerlink" href="#ForeignKeyMetadata" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="ForeignKeyMetadata.column">
<code class="descname">column</code><a class="headerlink" href="#ForeignKeyMetadata.column" title="Permalink to this definition">¶</a></dt>
<dd><p>The column containing the foreign key (the &#8220;source&#8221;).</p>
</dd></dl>

<dl class="attribute">
<dt id="ForeignKeyMetadata.dest_table">
<code class="descname">dest_table</code><a class="headerlink" href="#ForeignKeyMetadata.dest_table" title="Permalink to this definition">¶</a></dt>
<dd><p>The table referenced by the foreign key.</p>
</dd></dl>

<dl class="attribute">
<dt id="ForeignKeyMetadata.dest_column">
<code class="descname">dest_column</code><a class="headerlink" href="#ForeignKeyMetadata.dest_column" title="Permalink to this definition">¶</a></dt>
<dd><p>The column referenced by the foreign key (on <code class="docutils literal"><span class="pre">dest_table</span></code>).</p>
</dd></dl>

<dl class="attribute">
<dt id="ForeignKeyMetadata.table">
<code class="descname">table</code><a class="headerlink" href="#ForeignKeyMetadata.table" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the table containing this foreign key.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="misc">
<h2>Misc<a class="headerlink" href="#misc" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="fn">
<em class="property">class </em><code class="descname">fn</code><a class="headerlink" href="#fn" title="Permalink to this definition">¶</a></dt>
<dd><p>A helper class that will convert arbitrary function calls to SQL function calls.</p>
<p>To express functions in peewee, use the <a class="reference internal" href="#fn" title="fn"><code class="xref py py-class docutils literal"><span class="pre">fn</span></code></a> object.  The way it works is
anything to the right of the &#8220;dot&#8221; operator will be treated as a function.  You can
pass that function arbitrary parameters which can be other valid expressions.</p>
<p>For example:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Peewee expression</th>
<th class="head">Equivalent SQL</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">fn.Count(Tweet.id).alias('count')</span></code></td>
<td><code class="docutils literal"><span class="pre">Count(t1.&quot;id&quot;)</span> <span class="pre">AS</span> <span class="pre">count</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">fn.Lower(fn.Substr(User.username,</span> <span class="pre">1,</span> <span class="pre">1))</span></code></td>
<td><code class="docutils literal"><span class="pre">Lower(Substr(t1.&quot;username&quot;,</span> <span class="pre">1,</span> <span class="pre">1))</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">fn.Rand().alias('random')</span></code></td>
<td><code class="docutils literal"><span class="pre">Rand()</span> <span class="pre">AS</span> <span class="pre">random</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">fn.Stddev(Employee.salary).alias('sdv')</span></code></td>
<td><code class="docutils literal"><span class="pre">Stddev(t1.&quot;salary&quot;)</span> <span class="pre">AS</span> <span class="pre">sdv</span></code></td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="fn.over">
<code class="descname">over</code><span class="sig-paren">(</span><span class="optional">[</span><em>partition_by=None</em><span class="optional">[</span>, <em>order_by=None</em><span class="optional">[</span>, <em>window=None</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#fn.over" title="Permalink to this definition">¶</a></dt>
<dd><p>Basic support for SQL window functions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>partition_by</strong> (<em>list</em>) &#8211; List of <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a> instances to partition by.</li>
<li><strong>order_by</strong> (<em>list</em>) &#8211; List of <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a> instances to use for ordering.</li>
<li><strong>window</strong> (<a class="reference internal" href="#Window" title="Window"><em>Window</em></a>) &#8211; A <a class="reference internal" href="#Window" title="Window"><code class="xref py py-class docutils literal"><span class="pre">Window</span></code></a> instance to use for this aggregate.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Get the list of employees and the average salary for their dept.</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Employee</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">department</span><span class="p">,</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">salary</span><span class="p">,</span>
             <span class="n">fn</span><span class="o">.</span><span class="n">Avg</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">salary</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span>
                 <span class="n">partition_by</span><span class="o">=</span><span class="p">[</span><span class="n">Employee</span><span class="o">.</span><span class="n">department</span><span class="p">]))</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

<span class="c"># Rank employees by salary.</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Employee</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">salary</span><span class="p">,</span>
             <span class="n">fn</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span>
                 <span class="n">order_by</span><span class="o">=</span><span class="p">[</span><span class="n">Employee</span><span class="o">.</span><span class="n">salary</span><span class="p">])))</span>

<span class="c"># Get a list of page-views, along with avg pageviews for that day.</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">PageView</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span>
             <span class="n">PageView</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
             <span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
             <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span>
                 <span class="n">partition_by</span><span class="o">=</span><span class="p">[</span><span class="n">fn</span><span class="o">.</span><span class="n">date_trunc</span><span class="p">(</span>
                     <span class="s">&#39;day&#39;</span><span class="p">,</span> <span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)]))</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span>

<span class="c"># Same as above but using a window class.</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="p">(</span><span class="n">partition_by</span><span class="o">=</span><span class="p">[</span><span class="n">fn</span><span class="o">.</span><span class="n">date_trunc</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">,</span> <span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)])</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">PageView</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span>
             <span class="n">PageView</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
             <span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
             <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">))</span>
         <span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>  <span class="c"># Need to include our Window here.</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="SQL">
<em class="property">class </em><code class="descname">SQL</code><span class="sig-paren">(</span><em>sql</em>, <em>*params</em><span class="sig-paren">)</span><a class="headerlink" href="#SQL" title="Permalink to this definition">¶</a></dt>
<dd><p>Add fragments of SQL to a peewee query.  For example you might want to reference
an aliased name.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>sql</strong> (<em>str</em>) &#8211; Arbitrary SQL string.</li>
<li><strong>params</strong> &#8211; Arbitrary query parameters.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Retrieve user table and &quot;annotate&quot; it with a count of tweets for each</span>
<span class="c"># user.</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;ct&#39;</span><span class="p">))</span>
         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">JOIN</span><span class="o">.</span><span class="n">LEFT_OUTER</span><span class="p">)</span>
         <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="p">))</span>

<span class="c"># Sort the users by number of tweets.</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">SQL</span><span class="p">(</span><span class="s">&#39;ct DESC&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="Window">
<em class="property">class </em><code class="descname">Window</code><span class="sig-paren">(</span><span class="optional">[</span><em>partition_by=None</em><span class="optional">[</span>, <em>order_by=None</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Window" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a <code class="docutils literal"><span class="pre">WINDOW</span></code> definition.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>partition_by</strong> (<em>list</em>) &#8211; List of <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a> instances to partition by.</li>
<li><strong>order_by</strong> (<em>list</em>) &#8211; List of <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a> instances to use for ordering.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Get the list of employees and the average salary for their dept.</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="p">(</span><span class="n">partition_by</span><span class="o">=</span><span class="p">[</span><span class="n">Employee</span><span class="o">.</span><span class="n">department</span><span class="p">])</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">&#39;dept_w&#39;</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Employee</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">department</span><span class="p">,</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">salary</span><span class="p">,</span>
             <span class="n">fn</span><span class="o">.</span><span class="n">Avg</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">salary</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
         <span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="Proxy">
<em class="property">class </em><code class="descname">Proxy</code><a class="headerlink" href="#Proxy" title="Permalink to this definition">¶</a></dt>
<dd><p>Proxy class useful for situations when you wish to defer the initialization of
an object.  For instance, you want to define your models but you do not know
what database engine you will be using until runtime.</p>
<p>Example:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">database_proxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">()</span>  <span class="c"># Create a proxy for our db.</span>

<span class="k">class</span> <span class="nc">BaseModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database_proxy</span>  <span class="c"># Use proxy for our DB.</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

<span class="c"># Based on configuration, use a different database.</span>
<span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;DEBUG&#39;</span><span class="p">]:</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;local.db&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;TESTING&#39;</span><span class="p">]:</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s">&#39;:memory:&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">PostgresqlDatabase</span><span class="p">(</span><span class="s">&#39;mega_production_db&#39;</span><span class="p">)</span>

<span class="c"># Configure our proxy to use the db we specified in config.</span>
<span class="n">database_proxy</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<dl class="method">
<dt id="Proxy.initialize">
<code class="descname">initialize</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="headerlink" href="#Proxy.initialize" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>obj</strong> &#8211; The object to proxy to.</td>
</tr>
</tbody>
</table>
<p>Once initialized, the attributes and methods on <code class="docutils literal"><span class="pre">obj</span></code> can be accessed
directly via the <a class="reference internal" href="#Proxy" title="Proxy"><code class="xref py py-class docutils literal"><span class="pre">Proxy</span></code></a> instance.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="Node">
<em class="property">class </em><code class="descname">Node</code><a class="headerlink" href="#Node" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a> class is the parent class for all composable parts of a query, and forms the basis of peewee&#8217;s expression API. The following classes extend <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a>:</p>
<ul class="simple">
<li><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a>, <a class="reference internal" href="#UpdateQuery" title="UpdateQuery"><code class="xref py py-class docutils literal"><span class="pre">UpdateQuery</span></code></a>, <a class="reference internal" href="#InsertQuery" title="InsertQuery"><code class="xref py py-class docutils literal"><span class="pre">InsertQuery</span></code></a>, <a class="reference internal" href="#DeleteQuery" title="DeleteQuery"><code class="xref py py-class docutils literal"><span class="pre">DeleteQuery</span></code></a>, and <a class="reference internal" href="#RawQuery" title="RawQuery"><code class="xref py py-class docutils literal"><span class="pre">RawQuery</span></code></a>.</li>
<li><code class="xref py py-class docutils literal"><span class="pre">Field</span></code></li>
<li><code class="xref py py-class docutils literal"><span class="pre">Func</span></code> (and <a class="reference internal" href="#fn" title="fn"><code class="xref py py-func docutils literal"><span class="pre">fn()</span></code></a>)</li>
<li><a class="reference internal" href="#SQL" title="SQL"><code class="xref py py-class docutils literal"><span class="pre">SQL</span></code></a></li>
<li><code class="xref py py-class docutils literal"><span class="pre">Expression</span></code></li>
<li><code class="xref py py-class docutils literal"><span class="pre">Param</span></code></li>
<li><a class="reference internal" href="#Window" title="Window"><code class="xref py py-class docutils literal"><span class="pre">Window</span></code></a></li>
<li><code class="xref py py-class docutils literal"><span class="pre">Clause</span></code></li>
<li><code class="xref py py-class docutils literal"><span class="pre">Entity</span></code></li>
<li><code class="xref py py-class docutils literal"><span class="pre">Check</span></code></li>
</ul>
<p>Overridden operators:</p>
<ul class="simple">
<li>Bitwise and- and or- (<code class="docutils literal"><span class="pre">&amp;</span></code> and <code class="docutils literal"><span class="pre">|</span></code>): combine multiple nodes using the given conjunction.</li>
<li><code class="docutils literal"><span class="pre">+</span></code>, <code class="docutils literal"><span class="pre">-</span></code>, <code class="docutils literal"><span class="pre">*</span></code>, <code class="docutils literal"><span class="pre">/</span></code> and <code class="docutils literal"><span class="pre">^</span></code> (add, subtract, multiply, divide and exclusive-or).</li>
<li><code class="docutils literal"><span class="pre">==</span></code>, <code class="docutils literal"><span class="pre">!=</span></code>, <code class="docutils literal"><span class="pre">&lt;</span></code>, <code class="docutils literal"><span class="pre">&lt;=</span></code>, <code class="docutils literal"><span class="pre">&gt;</span></code>, <code class="docutils literal"><span class="pre">&gt;=</span></code>: create a binary expression using the given comparator.</li>
<li><code class="docutils literal"><span class="pre">&lt;&lt;</span></code>: create an <em>IN</em> expression.</li>
<li><code class="docutils literal"><span class="pre">&gt;&gt;</span></code>: create an <em>IS</em> expression.</li>
<li><code class="docutils literal"><span class="pre">%</span></code> and <code class="docutils literal"><span class="pre">**</span></code>: <em>LIKE</em> and <em>ILIKE</em>.</li>
</ul>
<dl class="method">
<dt id="Node.contains">
<code class="descname">contains</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#Node.contains" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a binary expression using case-insensitive string search.</p>
</dd></dl>

<dl class="method">
<dt id="Node.startswith">
<code class="descname">startswith</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#Node.startswith" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a binary expression using case-insensitive prefix search.</p>
</dd></dl>

<dl class="method">
<dt id="Node.endswith">
<code class="descname">endswith</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#Node.endswith" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a binary expression using case-insensitive suffix search.</p>
</dd></dl>

<dl class="method">
<dt id="Node.between">
<code class="descname">between</code><span class="sig-paren">(</span><em>low</em>, <em>high</em><span class="sig-paren">)</span><a class="headerlink" href="#Node.between" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an expression that will match values between <code class="docutils literal"><span class="pre">low</span></code> and <code class="docutils literal"><span class="pre">high</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="Node.regexp">
<code class="descname">regexp</code><span class="sig-paren">(</span><em>expression</em><span class="sig-paren">)</span><a class="headerlink" href="#Node.regexp" title="Permalink to this definition">¶</a></dt>
<dd><p>Match based on regular expression.</p>
</dd></dl>

<dl class="method">
<dt id="Node.concat">
<code class="descname">concat</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#Node.concat" title="Permalink to this definition">¶</a></dt>
<dd><p>Concatenate the current node with the provided <code class="docutils literal"><span class="pre">rhs</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="Node.is_null">
<code class="descname">is_null</code><span class="sig-paren">(</span><span class="optional">[</span><em>is_null=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Node.is_null" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an expression testing whether the <code class="docutils literal"><span class="pre">Node</span></code> is (or is not) <code class="docutils literal"><span class="pre">NULL</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Find all categories whose parent column is NULL.</span>
<span class="n">root_nodes</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_null</span><span class="p">())</span>

<span class="c"># Find all categores whose parent is NOT NULL.</span>
<span class="n">child_nodes</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_null</span><span class="p">(</span><span class="bp">False</span><span class="p">))</span>
</pre></div>
</div>
<p>To simplify things, peewee will generate the correct SQL for equality and inequality. The <a class="reference internal" href="#Node.is_null" title="Node.is_null"><code class="xref py py-meth docutils literal"><span class="pre">is_null()</span></code></a> method is provided simply for readability.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Equivalent to the previous queries -- peewee will translate these</span>
<span class="c"># into `IS NULL` and `IS NOT NULL`:</span>
<span class="n">root_nodes</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="bp">None</span><span class="p">)</span>
<span class="n">child_nodes</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">parent</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Node.__invert__">
<code class="descname">__invert__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Node.__invert__" title="Permalink to this definition">¶</a></dt>
<dd><p>Negate the node. This translates roughly into <em>NOT (&lt;node&gt;)</em>.</p>
</dd></dl>

<dl class="method">
<dt id="Node.alias">
<code class="descname">alias</code><span class="sig-paren">(</span><span class="optional">[</span><em>name=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Node.alias" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply an alias to the given node. This translates into <em>&lt;node&gt; AS &lt;name&gt;</em>.</p>
</dd></dl>

<dl class="method">
<dt id="Node.asc">
<code class="descname">asc</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Node.asc" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply ascending ordering to the given node. This translates into <em>&lt;node&gt; ASC</em>.</p>
</dd></dl>

<dl class="method">
<dt id="Node.desc">
<code class="descname">desc</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Node.desc" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply descending ordering to the given node. This translates into <em>&lt;node&gt; DESC</em>.</p>
</dd></dl>

<dl class="method">
<dt id="Node.bind_to">
<code class="descname">bind_to</code><span class="sig-paren">(</span><em>model_class</em><span class="sig-paren">)</span><a class="headerlink" href="#Node.bind_to" title="Permalink to this definition">¶</a></dt>
<dd><p>Bind the results of an expression to a specific model type. Useful when adding expressions to a select, where the result of the expression should be placed on a particular joined instance.</p>
</dd></dl>

<dl class="classmethod">
<dt id="Node.extend">
<em class="property">classmethod </em><code class="descname">extend</code><span class="sig-paren">(</span><span class="optional">[</span><em>name=None</em><span class="optional">[</span>, <em>clone=False</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Node.extend" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator for adding the decorated function as a new method on <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a> and its subclasses. Useful for adding implementation-specific features to all node types.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<em>str</em>) &#8211; Method name. If not provided the name of the wrapped function will be used.</li>
<li><strong>clone</strong> (<em>bool</em>) &#8211; Whether this method should return a clone. This is generally true when the method mutates the internal state of the node.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Add a `cast()` method to all nodes using the &#39;::&#39; operator.</span>
<span class="n">PostgresqlDatabase</span><span class="o">.</span><span class="n">register_ops</span><span class="p">({</span><span class="s">&#39;::&#39;</span><span class="p">,</span> <span class="s">&#39;::&#39;</span><span class="p">})</span>

<span class="nd">@Node.extend</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">cast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_type</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;::&#39;</span><span class="p">,</span> <span class="n">SQL</span><span class="p">(</span><span class="n">as_type</span><span class="p">))</span>

<span class="c"># Let&#39;s pretend we want to find all data points whose numbers</span>
<span class="c"># are palindromes. Note that we can use the new *cast* method</span>
<span class="c"># on both fields and with the `fn` helper:</span>
<span class="n">reverse_val</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">REVERSE</span><span class="p">(</span><span class="n">DataModel</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s">&#39;str&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s">&#39;int&#39;</span><span class="p">)</span>

<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">DataPoint</span>
         <span class="o">.</span><span class="n">select</span><span class="p">()</span>
         <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">DataPoint</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">reverse_val</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To remove an extended method, simply call <code class="docutils literal"><span class="pre">delattr</span></code> on the class the method was originally added to.</p>
</div>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">API Reference</a><ul>
<li><a class="reference internal" href="#models">Models</a></li>
<li><a class="reference internal" href="#fields">Fields</a></li>
<li><a class="reference internal" href="#query-types">Query Types</a></li>
<li><a class="reference internal" href="#database-and-its-subclasses">Database and its subclasses</a></li>
<li><a class="reference internal" href="#transaction-savepoint-and-executioncontext">Transaction, Savepoint and ExecutionContext</a></li>
<li><a class="reference internal" href="#metadata-types">Metadata Types</a></li>
<li><a class="reference internal" href="#misc">Misc</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="transactions.html"
                        title="previous chapter">Transactions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="playhouse.html"
                        title="next chapter">Playhouse, a collection of addons</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/peewee/api.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="playhouse.html" title="Playhouse, a collection of addons"
             >next</a> |</li>
        <li class="right" >
          <a href="transactions.html" title="Transactions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">peewee 2.6.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright charles leifer.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>